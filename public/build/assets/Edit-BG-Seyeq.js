import{d as Z,c as D,s as z,C as W,B as h,a as c,o as m,b as l,e as s,m as X,w as d,f as r,p as L,g as u,t as v,F as y,r as V,j as Y,k as N,G as I,i as q,l as P,P as ee}from"./app-_LMAJuVE.js";import{_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-BmACvFIT.js";import{_ as p}from"./Label.vue_vue_type_script_setup_true_lang-C_TUXjAG.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-CFXrkFXk.js";import{_ as se}from"./Checkbox.vue_vue_type_script_setup_true_lang-DRJ7oBAE.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-CxrUyqSn.js";import{_ as ie}from"./RichTextEditor.vue_vue_type_script_setup_true_lang-_IxO11tl.js";import{_ as C}from"./index-CyzG3B7Q.js";import{c as oe}from"./i18n-B6-dBLr6.js";import{_ as le}from"./TicketDefinitionMiniForm.vue_vue_type_script_setup_true_lang-DLfCP2jD.js";import{_ as ne}from"./TicketDefinitionSelector.vue_vue_type_script_setup_true_lang-BpfPie11.js";import"./index-DskH3tKn.js";import"./useForwardPropsEmits-mgxhVe2d.js";import"./useForwardExpose-DvgX0o-v.js";import"./useFocusGuards-_TrNIUuM.js";import"./Teleport-sQDXNy6f.js";import"./VisuallyHidden-BEO5d0G6.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-43_aYyr-.js";import"./RovingFocusGroup-DvsoFtKQ.js";import"./createLucideIcon-BM0PkPLY.js";import"./x-BMJwbN6X.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CmZdlobI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-BEKNO1yO.js";import"./check-Ci75AEab.js";import"./useFormControl-BuzPDrCk.js";import"./VisuallyHiddenInput-DuwjuwTY.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DhHhITqF.js";import"./DialogClose.vue_vue_type_script_setup_true_lang-DJ124MiU.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-DKiLW2nx.js";const re={class:"py-12 px-4 sm:px-6 lg:px-8 max-w-4xl mx-auto"},ae={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},de={class:"p-6"},ue={class:"text-lg font-medium leading-6 text-gray-900 dark:text-white"},ce={class:"text-indigo-600 dark:text-indigo-400"},me={class:"px-6 py-5"},_e={class:"border-b border-gray-200 dark:border-gray-700 mb-4"},ge={class:"-mb-px flex space-x-8","aria-label":"Tabs"},pe=["onClick"],fe={class:"mb-4"},ve={class:"mb-4"},ke={class:"px-6 py-5 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"},ye={class:"px-6 py-5"},be={class:"mb-4"},xe={key:0,class:"mb-4"},he={key:1,class:"mb-4"},Ve=["value"],we={class:"mb-4"},Te={class:"col-span-6 sm:col-span-3"},$e={class:"px-6 py-5"},Ue={class:"mb-4"},Se=["value"],Ce={class:"px-6 py-5 border-t border-gray-200 dark:border-gray-700"},De={class:"flex justify-between items-center mb-4"},ze={class:"space-x-2"},Ne={key:0,class:"p-4 border border-dashed rounded-md text-center text-gray-500 dark:text-gray-400"},Ee={key:1,class:"space-y-4"},Ae={class:"flex justify-between items-start mb-3"},Fe={class:"font-semibold text-gray-800 dark:text-gray-100"},Me={class:"text-xs text-gray-500 dark:text-gray-400"},Le={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},qe={class:"p-6 flex justify-end space-x-3"},pt=Z({__name:"Edit",props:{event:{},occurrence:{},venues:{},availableLocales:{},occurrenceStatuses:{},errors:{},pageTitle:{},breadcrumbs:{},allAvailableTicketDefinitions:{},ticketDefinitionStatuses:{},assignedTickets:{}},setup(j){var A,F,M;const n=j,w=D(()=>Object.entries(n.availableLocales).map(([o,e])=>({key:o,label:e}))),T=z(oe.value||((A=w.value[0])==null?void 0:A.key)||"en"),$=o=>o?o.slice(0,16):"",U=o=>{const e={};return w.value.forEach(a=>{e[a.key]=o&&o[a.key]?o[a.key]:""}),e},i=W({_method:"PUT",event_id:n.event.id,name:U(n.occurrence.name),description:U(n.occurrence.description),start_at:$(n.occurrence.start_at),end_at:$(n.occurrence.end_at),venue_id:n.occurrence.venue_id||null,is_online:n.occurrence.is_online||!1,online_meeting_link:n.occurrence.online_meeting_link||"",capacity:n.occurrence.capacity??null,status:n.occurrence.status||((F=n.occurrenceStatuses.find(o=>o.value==="scheduled"))==null?void 0:F.value)||((M=n.occurrenceStatuses[0])==null?void 0:M.value)||"",timezone:n.occurrence.timezone||"Asia/Hong_Kong",assigned_tickets:n.assignedTickets?JSON.parse(JSON.stringify(n.assignedTickets)):[]});h(()=>i.is_online,o=>{o?i.venue_id=null:i.online_meeting_link=""}),h(()=>i.assigned_tickets,()=>{},{deep:!0});const O=D(()=>[{value:"",label:"Select a Venue (if applicable)"},...n.venues.map(o=>({value:o.id,label:o.name}))]),B=D(()=>n.occurrenceStatuses.map(o=>({value:o.value,label:o.label}))),K=()=>{i.post(route("admin.occurrences.update",{occurrence:n.occurrence.id}),{onSuccess:()=>{},onError:o=>{console.error("Error updating occurrence:",o)}})};h(()=>n.occurrence,o=>{var e,a;o&&(i.name=U(o.name),i.description=U(o.description),i.start_at=$(o.start_at),i.end_at=$(o.end_at),i.venue_id=o.venue_id||null,i.is_online=o.is_online||!1,i.online_meeting_link=o.online_meeting_link||"",i.capacity=o.capacity??null,i.status=o.status||((e=n.occurrenceStatuses.find(f=>f.value==="scheduled"))==null?void 0:e.value)||((a=n.occurrenceStatuses[0])==null?void 0:a.value)||"",i.timezone=o.timezone||"Asia/Hong_Kong",i.errors={})},{deep:!0});const b=z(!1),x=z(!1);h(()=>x.value,()=>{}),h(()=>b.value,()=>{});const H=o=>{var e;b.value=!1,alert('Ticket definition "'+(((e=o.name)==null?void 0:e.en)||o.id)+'" created. It will be available in the selector after a page refresh or next visit.')},G=o=>{const e=[];o.forEach(a=>{const f=i.assigned_tickets.find(t=>t.ticket_definition_id===a);if(f)e.push(f);else{const t=n.allAvailableTicketDefinitions.find(g=>g.id===a);t?e.push({ticket_definition_id:a,name:t.name,original_price:t.price,original_currency_code:t.currency_code,quantity_for_occurrence:void 0,price_override:void 0}):console.error("Ticket definition not found for ID:",a)}}),i.assigned_tickets=e,x.value=!1},J=o=>{i.assigned_tickets=i.assigned_tickets.filter(e=>e.ticket_definition_id!==o)},Q=o=>{var e;return((e=n.allAvailableTicketDefinitions.find(a=>a.id===o))==null?void 0:e.name)||"Unknown Ticket"},R=(o,e)=>{if(o==null||e===null||e===void 0)return"N/A";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(o/100)}catch{return` ${(o/100).toFixed(2)} ${e}`}},E=(o,e)=>{var f;const a=`assigned_tickets.${o}.${e}`;return(f=i.errors)==null?void 0:f[a]};return(o,e)=>{var a;return m(),c(y,null,[l(s(X),{title:n.pageTitle||`Edit Occurrence: ${((a=n.occurrence.name)==null?void 0:a[T.value])||n.occurrence.id}`},null,8,["title"]),l(te,{"page-title":n.pageTitle||`Edit Occurrence for Event: ${n.event.name}`,breadcrumbs:n.breadcrumbs},{default:d(()=>{var f;return[r("div",re,[r("div",ae,[r("form",{onSubmit:L(K,["prevent"]),class:"divide-y divide-gray-200 dark:divide-gray-700"},[r("div",de,[r("h2",ue,[e[12]||(e[12]=u(" Edit Occurrence ")),r("span",ce,"#"+v(n.occurrence.id),1),u(" for: "+v(n.event.name),1)]),e[13]||(e[13]=r("p",{class:"mt-1 text-sm text-gray-600 dark:text-gray-400"}," Update the details for this event occurrence. ",-1))]),r("div",me,[r("div",_e,[r("nav",ge,[(m(!0),c(y,null,V(w.value,t=>(m(),c("button",{key:t.key,onClick:L(g=>T.value=t.key,["prevent"]),class:Y([T.value===t.key?"border-indigo-500 text-indigo-600 dark:border-indigo-400 dark:text-indigo-300":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:border-gray-600","whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm focus:outline-none"])},v(t.label),11,pe))),128))])]),(m(!0),c(y,null,V(w.value,t=>N((m(),c("div",{key:t.key},[r("div",fe,[l(s(p),{for:"name_"+t.key},{default:d(()=>[u(v("Name ("+t.label+")"),1)]),_:2},1032,["for"]),l(s(k),{id:"name_"+t.key,modelValue:s(i).name[t.key],"onUpdate:modelValue":g=>s(i).name[t.key]=g,type:"text",class:"mt-1 block w-full",placeholder:"Occurrence Name in "+t.label},null,8,["id","modelValue","onUpdate:modelValue","placeholder"]),l(_,{message:s(i).errors[`name.${t.key}`],class:"mt-1"},null,8,["message"])]),r("div",ve,[l(s(p),{for:"description_"+t.key},{default:d(()=>[u(v("Description ("+t.label+")"),1)]),_:2},1032,["for"]),l(ie,{id:"description_"+t.key,modelValue:s(i).description[t.key],"onUpdate:modelValue":g=>s(i).description[t.key]=g,class:"mt-1 block w-full",placeholder:"Detailed description in "+t.label+" (optional)"},null,8,["id","modelValue","onUpdate:modelValue","placeholder"]),l(_,{message:s(i).errors[`description.${t.key}`],class:"mt-1"},null,8,["message"])])])),[[I,T.value===t.key]])),128)),l(_,{message:s(i).errors.name,class:"mt-1"},null,8,["message"]),l(_,{message:s(i).errors.description,class:"mt-1"},null,8,["message"])]),r("div",ke,[r("div",null,[l(s(p),{for:"start_at"},{default:d(()=>e[14]||(e[14]=[u("Start Date & Time")])),_:1}),l(s(k),{id:"start_at",modelValue:s(i).start_at,"onUpdate:modelValue":e[0]||(e[0]=t=>s(i).start_at=t),type:"datetime-local",class:"mt-1 block w-full"},null,8,["modelValue"]),l(_,{message:s(i).errors.start_at,class:"mt-1"},null,8,["message"])]),r("div",null,[l(s(p),{for:"end_at"},{default:d(()=>e[15]||(e[15]=[u("End Date & Time")])),_:1}),l(s(k),{id:"end_at",modelValue:s(i).end_at,"onUpdate:modelValue":e[1]||(e[1]=t=>s(i).end_at=t),type:"datetime-local",class:"mt-1 block w-full"},null,8,["modelValue"]),l(_,{message:s(i).errors.end_at,class:"mt-1"},null,8,["message"])])]),r("div",ye,[r("div",be,[l(s(p),{class:"flex items-center"},{default:d(()=>[l(s(se),{id:"is_online",checked:s(i).is_online,"onUpdate:checked":e[2]||(e[2]=t=>s(i).is_online=t)},null,8,["checked"]),e[16]||(e[16]=r("span",{class:"ml-2 text-sm text-gray-600 dark:text-gray-400"},"This is an online occurrence",-1))]),_:1}),l(_,{message:s(i).errors.is_online,class:"mt-1"},null,8,["message"])]),s(i).is_online?(m(),c("div",xe,[l(s(p),{for:"online_meeting_link"},{default:d(()=>e[17]||(e[17]=[u("Online Meeting Link (e.g., Zoom, Google Meet)")])),_:1}),l(s(k),{id:"online_meeting_link","model-value":s(i).online_meeting_link===null?"":s(i).online_meeting_link,"onUpdate:modelValue":e[3]||(e[3]=t=>s(i).online_meeting_link=t===""||t===null?null:String(t)),type:"url",class:"mt-1 block w-full",placeholder:"https://..."},null,8,["model-value"]),l(_,{message:s(i).errors.online_meeting_link,class:"mt-1"},null,8,["message"])])):q("",!0),s(i).is_online?q("",!0):(m(),c("div",he,[l(s(p),{for:"venue_id"},{default:d(()=>e[18]||(e[18]=[u("Venue")])),_:1}),N(r("select",{id:"venue_id","onUpdate:modelValue":e[4]||(e[4]=t=>s(i).venue_id=t),class:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm"},[(m(!0),c(y,null,V(O.value,t=>(m(),c("option",{key:t.value,value:t.value},v(t.label),9,Ve))),128))],512),[[P,s(i).venue_id]]),l(_,{message:s(i).errors.venue_id,class:"mt-1"},null,8,["message"])])),r("div",we,[l(s(p),{for:"capacity"},{default:d(()=>e[19]||(e[19]=[u("Capacity (leave blank for unlimited)")])),_:1}),l(s(k),{id:"capacity","model-value":s(i).capacity===null?void 0:s(i).capacity,"onUpdate:modelValue":e[5]||(e[5]=t=>s(i).capacity=t===""||t===void 0||t===null?null:Number(t)),type:"number",min:"0",class:"mt-1 block w-full",placeholder:"e.g., 100"},null,8,["model-value"]),l(_,{message:s(i).errors.capacity,class:"mt-1"},null,8,["message"])]),r("div",Te,[l(s(p),{for:"timezone"},{default:d(()=>e[20]||(e[20]=[u("Timezone")])),_:1}),l(s(k),{id:"timezone",modelValue:s(i).timezone,"onUpdate:modelValue":e[6]||(e[6]=t=>s(i).timezone=t),type:"text",class:"mt-1 block w-full",placeholder:"e.g., Asia/Hong_Kong"},null,8,["modelValue"]),l(_,{message:s(i).errors.timezone,class:"mt-1"},null,8,["message"])])]),r("div",$e,[r("div",Ue,[l(s(p),{for:"status"},{default:d(()=>e[21]||(e[21]=[u("Status")])),_:1}),N(r("select",{id:"status","onUpdate:modelValue":e[7]||(e[7]=t=>s(i).status=t),class:"mt-1 block w-full border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 focus:border-indigo-500 dark:focus:border-indigo-600 focus:ring-indigo-500 dark:focus:ring-indigo-600 rounded-md shadow-sm"},[(m(!0),c(y,null,V(B.value,t=>(m(),c("option",{key:t.value,value:t.value},v(t.label),9,Se))),128))],512),[[P,s(i).status]]),l(_,{message:s(i).errors.status,class:"mt-1"},null,8,["message"])])]),r("div",Ce,[r("div",De,[e[24]||(e[24]=r("h3",{class:"text-base font-medium text-gray-900 dark:text-white"},"Manage Tickets for this Occurrence",-1)),r("div",ze,[l(s(C),{type:"button",variant:"outline",size:"sm",onClick:e[8]||(e[8]=t=>x.value=!0)},{default:d(()=>e[22]||(e[22]=[u(" Assign Existing Tickets ")])),_:1}),l(s(C),{type:"button",variant:"outline",size:"sm",onClick:e[9]||(e[9]=t=>b.value=!0)},{default:d(()=>e[23]||(e[23]=[u(" Create New Ticket Type ")])),_:1})])]),!s(i).assigned_tickets||s(i).assigned_tickets.length===0?(m(),c("div",Ne," No tickets assigned to this specific occurrence yet. (Count: "+v(((f=s(i).assigned_tickets)==null?void 0:f.length)||0)+") ",1)):(m(),c("div",Ee,[(m(!0),c(y,null,V(s(i).assigned_tickets,(t,g)=>(m(),c("div",{key:t.ticket_definition_id,class:"p-4 border rounded-md bg-gray-50 dark:bg-gray-700/50"},[r("div",Ae,[r("div",null,[r("h4",Fe,v(t.name||Q(t.ticket_definition_id)),1),r("p",Me," Original Price: "+v(R(t.original_price,t.original_currency_code)),1)]),l(s(C),{type:"button",variant:"ghost",size:"sm",onClick:S=>J(t.ticket_definition_id),class:"text-red-600 hover:text-red-700 dark:text-red-500 dark:hover:text-red-400"},{default:d(()=>e[25]||(e[25]=[u(" Remove ")])),_:2},1032,["onClick"])]),r("div",Le,[r("div",null,[l(s(p),{for:`assigned_ticket_qty_${g}`},{default:d(()=>e[26]||(e[26]=[u("Quantity for Occurrence")])),_:2},1032,["for"]),l(s(k),{id:`assigned_ticket_qty_${g}`,type:"number",modelValue:t.quantity_for_occurrence,"onUpdate:modelValue":S=>t.quantity_for_occurrence=S,modelModifiers:{number:!0},placeholder:"Unlimited",class:"mt-1 block w-full",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l(_,{message:E(g,"quantity_for_occurrence"),class:"mt-1"},null,8,["message"])]),r("div",null,[l(s(p),{for:`assigned_ticket_price_override_${g}`},{default:d(()=>e[27]||(e[27]=[u("Price Override (in cents)")])),_:2},1032,["for"]),l(s(k),{id:`assigned_ticket_price_override_${g}`,type:"number",modelValue:t.price_override,"onUpdate:modelValue":S=>t.price_override=S,modelModifiers:{number:!0},placeholder:"Use original price",class:"mt-1 block w-full",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l(_,{message:E(g,"price_override"),class:"mt-1"},null,8,["message"])])])]))),128))]))]),r("div",qe,[l(s(ee),{href:o.route("admin.events.occurrences.index",{event:n.event.id}),class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-800"},{default:d(()=>e[28]||(e[28]=[u(" Cancel ")])),_:1},8,["href"]),l(s(C),{disabled:s(i).processing},{default:d(()=>e[29]||(e[29]=[u(" Update Occurrence ")])),_:1},8,["disabled"])])],32)])]),l(le,{show:b.value,statuses:n.ticketDefinitionStatuses,"available-locales":n.availableLocales,onClose:e[10]||(e[10]=t=>b.value=!1),onTicketDefinitionCreated:H},null,8,["show","statuses","available-locales"]),l(ne,{show:x.value,"available-ticket-definitions":n.allAvailableTicketDefinitions,"initially-selected-ids":s(i).assigned_tickets.map(t=>t.ticket_definition_id),onClose:e[11]||(e[11]=t=>x.value=!1),onTicketDefinitionsSelected:G},null,8,["show","available-ticket-definitions","initially-selected-ids"])]}),_:1},8,["page-title","breadcrumbs"])],64)}}});export{pt as default};
