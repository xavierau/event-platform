import{d as H,s as u,a,o,b as M,f as e,i as n,e as R,m as W,w as G,g as j,P as q,t as l,F as _,r as k,k as I,v as Q,_ as U,j as v,W as T,h as J}from"./app-CBcdSYGl.js";import{d as E}from"./dayjs.min-Byr-DLKl.js";import{u as X}from"./utc-BTAAoPZS.js";import{Q as Z}from"./browser-_tJ77kRx.js";import{_ as ee}from"./FrontendFooter.vue_vue_type_script_setup_true_lang-C-uE7akA.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"min-h-screen bg-gray-100 dark:bg-gray-900"},re={class:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-50 border-b dark:border-gray-700"},oe={class:"container mx-auto flex items-center p-4 relative"},ae={class:"container mx-auto py-6 px-4 pb-24"},le={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"},ne={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ie={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},de={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ue={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ge={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},ye={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},xe={class:"text-2xl font-bold text-gray-600 dark:text-gray-400"},be={class:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6"},me={class:"p-6 border-b border-gray-200 dark:border-gray-700"},ve={class:"flex flex-wrap gap-2 mb-4"},fe=["onClick"],he={class:"flex gap-4"},pe={class:"flex-1"},_e={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},ke={class:"p-6 border-b border-gray-200 dark:border-gray-700"},we={class:"flex justify-between items-start mb-2"},Ce={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"text-gray-600 dark:text-gray-400 text-sm mb-3"},Me={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"font-mono"},je={key:0},Ne={class:"p-6"},Fe={class:"flex flex-wrap gap-2"},Se=["onClick","disabled"],qe=["onClick","disabled"],Ie={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Qe={class:"space-y-1"},Ue={key:0},Te={key:1,class:"text-center py-12"},Ee={class:"text-gray-600"},$e={key:2,class:"flex justify-center"},Ae={class:"flex space-x-2"},Be={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},De={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Oe={class:"flex justify-between items-start mb-4"},Le={key:0,class:"text-center"},Ve={class:"mb-4"},Ye={class:"font-medium"},ze={class:"text-sm text-gray-600"},Ke={class:"w-64 h-64 mx-auto bg-white border border-gray-200 rounded-lg flex items-center justify-center mb-4"},He=["src"],We={key:1,class:"text-center"},Ge={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Je={class:"bg-white rounded-lg p-6 max-w-md w-full mx-4"},Xe={class:"flex justify-between items-start mb-4"},Ze={key:0,class:"text-center"},et={class:"mb-6"},tt={class:"font-medium"},st={class:"text-sm text-gray-600"},rt={class:"space-y-4"},ot=["disabled"],at={key:0,class:"text-red-600 text-sm text-center"},lt=["disabled"],nt={key:0},it={key:1},dt=H({__name:"MyCoupons",props:{coupons:{type:Object,required:!0},statistics:{type:Object,required:!0},filters:{type:Object,required:!0}},setup(i){E.extend(X);const b=i,m=u(b.filters.search||""),w=u(b.filters.status||"all"),C=u(!1),f=u(!1),d=u(null),h=u(""),c=u(""),g=u(!1),y=u(""),$=[{key:"all",label:"All Coupons",count:b.statistics.total},{key:"active",label:"Active",count:b.statistics.active},{key:"expired",label:"Expired",count:b.statistics.expired},{key:"used",label:"Fully Used",count:b.statistics.fully_used}];function A(r){w.value=r,P()}function P(){T.get("/my-coupons",{status:w.value,search:m.value||void 0},{preserveState:!0,replace:!0})}function N(){P()}function B(){m.value="",P()}async function D(r){d.value=r;try{const t=await Z.toDataURL(r.unique_code,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});h.value=t}catch(t){console.error("Error generating QR code:",t),h.value=""}C.value=!0}function O(r){d.value=r,c.value="",y.value="",g.value=!1,f.value=!0}async function F(){var r;if(!(!d.value||!c.value)){if(c.value.length!==6){y.value="PIN must be exactly 6 digits";return}g.value=!0,y.value="";try{const s=await(await fetch("/api/v1/coupons/redeem-by-pin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({unique_code:d.value.unique_code,merchant_pin:c.value,location:"User Device - My Coupons"})})).json();s.success?(f.value=!1,T.reload()):y.value=s.message||"Invalid PIN. Please try again."}catch(t){console.error("PIN redemption error:",t),y.value="An error occurred. Please try again."}finally{g.value=!1}}}function L(r){return r.is_active?"text-green-600 bg-green-100":r.is_expired?"text-yellow-600 bg-yellow-100":(r.is_fully_used,"text-gray-600 bg-gray-100")}function V(r){return r.is_active?"Active":r.is_expired?"Expired":r.is_fully_used?"Fully Used":"Inactive"}function S(r){return E(r).format("MMM D, YYYY h:mm A")}function Y(r){return`${r.times_used} / ${r.times_can_be_used} uses`}function p(r){return r.is_active}function z(r){return r.coupon.redemption_methods.includes("qr")}function K(r){return r.coupon.redemption_methods.includes("pin")}return(r,t)=>(o(),a("div",se,[M(R(W),{title:"My Coupons"}),e("header",re,[e("div",oe,[M(R(q),{href:"/",class:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 absolute left-4"},{default:G(()=>t[4]||(t[4]=[j(" ← Back ")])),_:1}),t[5]||(t[5]=e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 flex-1 text-center"},"My Coupons",-1))])]),e("main",ae,[t[14]||(t[14]=e("div",{class:"mb-6"},[e("p",{class:"text-gray-600 dark:text-gray-300 text-center"},"Manage and redeem your coupons")],-1)),e("div",le,[e("div",ne,[e("div",ie,l(i.statistics.total),1),t[6]||(t[6]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Coupons",-1))]),e("div",de,[e("div",ue,l(i.statistics.active),1),t[7]||(t[7]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Active",-1))]),e("div",ce,[e("div",ge,l(i.statistics.expired),1),t[8]||(t[8]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Expired",-1))]),e("div",ye,[e("div",xe,l(i.statistics.fully_used),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fully Used",-1))])]),e("div",be,[e("div",me,[e("div",ve,[(o(),a(_,null,k($,s=>e("button",{key:s.key,onClick:x=>A(s.key),class:v(["px-4 py-2 rounded-md text-sm font-medium transition-colors",w.value===s.key?"bg-blue-100 dark:bg-blue-700 text-blue-700 dark:text-blue-200 border border-blue-300 dark:border-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},l(s.label)+" ("+l(s.count)+") ",11,fe)),64))]),e("div",he,[e("div",pe,[I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),onKeyup:U(N,["enter"]),type:"text",placeholder:"Search by coupon name, description, or code...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,544),[[Q,m.value]])]),e("button",{onClick:N,class:"px-4 py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors"}," Search "),m.value?(o(),a("button",{key:0,onClick:B,class:"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"}," Clear ")):n("",!0)])])]),i.coupons.data.length>0?(o(),a("div",_e,[(o(!0),a(_,null,k(i.coupons.data,s=>(o(),a("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden"},[e("div",ke,[e("div",we,[e("h3",Ce,l(s.coupon.name),1),e("span",{class:v(["px-2 py-1 text-xs font-medium rounded-full",L(s)])},l(V(s)),3)]),e("p",Pe,l(s.coupon.description),1),e("div",Me,[e("div",null,[t[10]||(t[10]=j("Code: ")),e("span",Re,l(s.unique_code),1)]),e("div",null,"Usage: "+l(Y(s)),1),s.expires_at?(o(),a("div",je," Expires: "+l(S(s.expires_at)),1)):n("",!0)])]),e("div",Ne,[e("div",Fe,[z(s)?(o(),a("button",{key:0,onClick:x=>D(s),disabled:!p(s),class:v(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors",p(s)?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Show QR Code ",10,Se)):n("",!0),K(s)?(o(),a("button",{key:1,onClick:x=>O(s),disabled:!p(s),class:v(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors",p(s)?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Redeem by PIN ",10,qe)):n("",!0)]),s.usage_logs.length>0?(o(),a("div",Ie,[t[11]||(t[11]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Recent Usage",-1)),e("div",Qe,[(o(!0),a(_,null,k(s.usage_logs.slice(0,2),x=>(o(),a("div",{key:x.id,class:"text-xs text-gray-600"},[j(l(S(x.created_at))+" ",1),x.location?(o(),a("span",Ue," at "+l(x.location),1)):n("",!0)]))),128))])])):n("",!0)])]))),128))])):(o(),a("div",Te,[t[12]||(t[12]=e("div",{class:"text-gray-400 text-6xl mb-4"},"🎫",-1)),t[13]||(t[13]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No coupons found",-1)),e("p",Ee,l(m.value?"Try adjusting your search or filters.":"You don't have any coupons yet."),1)])),i.coupons.links&&i.coupons.links.length>3?(o(),a("div",$e,[e("nav",Ae,[(o(!0),a(_,null,k(i.coupons.links,s=>(o(),J(R(q),{key:s.label,href:s.url,class:v(["px-3 py-2 text-sm rounded-md",s.active?"bg-blue-600 text-white":s.url?"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300":"bg-gray-100 text-gray-400 cursor-not-allowed"]),innerHTML:s.label},null,8,["href","class","innerHTML"]))),128))])])):n("",!0)]),M(ee),C.value?(o(),a("div",Be,[e("div",De,[e("div",Oe,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold"},"QR Code for Redemption",-1)),e("button",{onClick:t[1]||(t[1]=s=>C.value=!1),class:"text-gray-400 hover:text-gray-600"},t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),d.value?(o(),a("div",Le,[e("div",Ve,[e("h4",Ye,l(d.value.coupon.name),1),e("p",ze,l(d.value.unique_code),1)]),e("div",Ke,[h.value?(o(),a("img",{key:0,src:h.value,alt:"QR Code for coupon redemption",class:"w-full h-full object-contain p-2"},null,8,He)):(o(),a("div",We,t[17]||(t[17]=[e("div",{class:"text-gray-400 text-2xl mb-2"},"📱",-1),e("div",{class:"text-sm text-gray-600"},"Generating QR Code...",-1)])))]),t[18]||(t[18]=e("p",{class:"text-sm text-gray-600"},"Show this QR code to the merchant for scanning",-1))])):n("",!0)])])):n("",!0),f.value?(o(),a("div",Ge,[e("div",Je,[e("div",Xe,[t[20]||(t[20]=e("h3",{class:"text-lg font-semibold"},"PIN Redemption",-1)),e("button",{onClick:t[2]||(t[2]=s=>f.value=!1),class:"text-gray-400 hover:text-gray-600"},t[19]||(t[19]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),d.value?(o(),a("div",Ze,[e("div",et,[e("h4",tt,l(d.value.coupon.name),1),e("p",st,l(d.value.unique_code),1)]),t[22]||(t[22]=e("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"},[e("div",{class:"text-blue-800 text-sm"},[e("div",{class:"font-medium mb-2"},"🔐 PIN Redemption Process"),e("ol",{class:"text-left space-y-1 text-xs"},[e("li",null,"1. Hand your device to the merchant"),e("li",null,"2. Merchant enters their 6-digit PIN below"),e("li",null,"3. Coupon will be redeemed automatically")])])],-1)),e("div",rt,[e("div",null,[t[21]||(t[21]=e("label",{for:"merchantPin",class:"block text-sm font-medium text-gray-700 mb-2"}," Merchant PIN (6 digits) ",-1)),I(e("input",{id:"merchantPin","onUpdate:modelValue":t[3]||(t[3]=s=>c.value=s),type:"text",inputmode:"numeric",pattern:"[0-9]{6}",maxlength:"6",placeholder:"Enter 6-digit PIN",class:"w-full px-4 py-3 text-center text-lg font-mono border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:g.value,onKeyup:U(F,["enter"])},null,40,ot),[[Q,c.value]])]),y.value?(o(),a("div",at,l(y.value),1)):n("",!0),e("button",{onClick:F,disabled:g.value||c.value.length!==6,class:v(["w-full py-3 px-4 rounded-md text-white font-medium transition-colors",[g.value||c.value.length!==6?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"]])},[g.value?(o(),a("span",nt,"Processing...")):(o(),a("span",it,"Redeem Coupon"))],10,lt)])])):n("",!0)])])):n("",!0)]))}}),mt=te(dt,[["__scopeId","data-v-39549f7b"]]);export{mt as default};
