import{d as j,n as L,s,C as G,c as A,z as K,x as J,a as o,o as t,b as f,e as b,m as W,w,f as a,i as u,k as X,t as l,F as U,r as Z,l as ee,h as ae,g as C}from"./app-CBcdSYGl.js";import{_ as F}from"./index-BH95GTik.js";import{U as se,_ as te}from"./vue-qrcode-reader-BpKQ1_AI.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cykr0hji.js";import"./index-B_RuNNQq.js";import"./useForwardPropsEmits-BUmNaTt4.js";import"./useForwardExpose-2b0zYAwj.js";import"./useFocusGuards-BRQO_hst.js";import"./Teleport-BsQYp6hP.js";import"./VisuallyHidden-dajNmunB.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-CPh5rXLj.js";import"./RovingFocusGroup-3mJjWm0y.js";import"./createLucideIcon-dtD6wVEP.js";import"./x-Br0THnaC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C3rar4t_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-C_yoBaOs.js";const oe={class:"py-12"},le={class:"max-w-4xl mx-auto sm:px-6 lg:px-8"},ne={class:"bg-white dark:bg-gray-800 shadow-sm sm:rounded-lg p-6"},ue={key:0,class:"mb-6"},ie={value:null},ce=["value"],de={key:0,class:"text-sm text-yellow-600 mt-1"},me={key:1,class:"text-sm text-blue-600 mt-1"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ge={class:"border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden relative aspect-square md:aspect-auto min-h-[300px]"},pe={key:0,class:"p-4 bg-red-100 text-red-700 text-sm"},fe={key:0,class:"mt-1"},be={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-700"},ye={class:"space-y-4"},_e={class:"bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-md p-3 text-xs"},ke={class:"space-y-1 text-blue-800 dark:text-blue-200"},he={key:0,class:"flex items-center text-sm text-gray-600 dark:text-gray-400"},xe={key:1,class:"p-3 bg-green-50 dark:bg-green-700 border border-green-300 dark:border-green-600 rounded-md text-sm text-green-700 dark:text-green-200"},we={key:2,class:"p-3 bg-red-50 dark:bg-red-700 border border-red-300 dark:border-red-600 rounded-md text-sm text-red-700 dark:text-red-200"},Ce={key:3,class:"text-sm text-gray-500 dark:text-gray-400"},Se={key:4,class:"text-sm text-gray-500 dark:text-gray-400"},Ee={key:0},Pe={key:1},Ne={class:"mt-6 flex justify-between"},Ge=j({__name:"Index",setup(Ae){var T;const v=L().props,S=s(!1),n=s(null),y=s(null),V=s(null),i=s(null),c=s(!1),E=s(!1),_=s(!1),k=s(null),q=s(0),Q=s(null),P=s(!1),h=s(null),R=s(!1),D=s(!1),M=s(!1),Y=s(""),$=G({unique_code:"",location:"Scanner",details:{},operator_user_id:(T=v.auth.user)==null?void 0:T.id}),N=A(()=>v.user_role==="admin"),g=A(()=>v.user_role==="admin"),x=A(()=>!0),I=async r=>{if(c.value||r.length===0)return;const e=r[0].rawValue;_.value=!0,c.value=!0,n.value=null;try{const m=await fetch(route("api.v1.coupon-scanner.show",{uniqueCode:e})),d=await m.json();m.ok&&d.success?(h.value=d.data,n.value={success:`Coupon ${d.data.user_coupon.unique_code} found.`},$.unique_code=d.data.user_coupon.unique_code,E.value=!0):n.value={error:d.message||"Failed to validate coupon."}}catch(m){n.value={error:m.message||"Error processing QR code."}}finally{_.value=!1,c.value=!1}},B=r=>{let e=`Camera error: ${r.name}`;switch(r.name){case"NotAllowedError":e="Camera access denied. Please allow camera access in your browser settings and refresh the page.";break;case"NotFoundError":e="No camera found. Please ensure a camera is connected to your device.";break;case"NotReadableError":e="Camera is already in use by another application. Please close other apps using the camera.";break;case"OverconstrainedError":e="Camera constraints could not be satisfied. Try refreshing the page.";break;case"SecurityError":e="Camera access blocked due to security restrictions. Ensure you are on HTTPS.";break;case"AbortError":e="Camera access was aborted. Please try again.";break;default:e=`Camera error: ${r.name}. ${r.message||"Please ensure camera access is allowed."}`}i.value=e},H=()=>{S.value=!0,i.value=null},z=async()=>{n.value=null,h.value=null,V.value=null,k.value=null,c.value=!1,E.value=!1,_.value=!1,Q.value=null,i.value=null,P.value=!0,await new Promise(r=>setTimeout(r,100)),P.value=!1,g.value},O=async()=>{if(typeof navigator>"u"||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){alert("Camera API not supported in this browser");return}try{(await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})).getTracks().forEach(e=>{e.stop()}),alert("✅ Camera access test successful!")}catch(r){console.error("Camera access test failed:",r);let e="Camera access failed: ";switch(r.name){case"NotAllowedError":e+="Permission denied. Please allow camera access and try again.";break;case"NotFoundError":e+="No camera found. Please ensure a camera is connected.";break;case"NotReadableError":e+="Camera is in use by another application.";break;case"SecurityError":e+="Security error. Ensure you are on HTTPS.";break;default:e+=r.message||"Unknown error occurred."}alert(e)}};return K(()=>{typeof window<"u"&&(R.value=window.location.protocol==="https:",D.value=window.isSecureContext,M.value=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),Y.value=window.location.href)}),J(()=>{}),(r,e)=>(t(),o(U,null,[f(b(W),{title:"QR Code Scanner"}),f(re,{title:"QR Code "},{default:w(()=>{var m,d;return[a("div",oe,[a("div",le,[a("div",ne,[N.value&&b(v).events.length>0?(t(),o("div",ue,[e[1]||(e[1]=a("label",{for:"event-select",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," Select Event to Scan For: ",-1)),X(a("select",{id:"event-select","onUpdate:modelValue":e[0]||(e[0]=p=>y.value=p),class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"},[a("option",ie,l(g.value?"-- All Events (Platform Admin) --":"-- Select an Event --"),1),(t(!0),o(U,null,Z(b(v).events,p=>(t(),o("option",{key:p.id,value:p.id},l(p.name),9,ce))),128))],512),[[ee,y.value]]),!y.value&&N.value&&!g.value?(t(),o("p",de," Admins: Please select an event to enable the scanner. ")):u("",!0),g.value?(t(),o("p",me," Platform Admin: You can scan QR codes for any event. Optionally select a specific event to filter results. ")):u("",!0)])):u("",!0),a("div",ve,[a("div",ge,[i.value?(t(),o("div",pe,[C(l(i.value)+" ",1),i.value.includes("NotAllowedError")||i.value.includes("NotFoundError")?(t(),o("p",fe," Please grant camera permissions in your browser settings and ensure a camera is connected, then refresh the page. ")):u("",!0)])):u("",!0),!i.value&&x.value?(t(),ae(b(se),{key:q.value,paused:P.value,onDetect:I,onError:B,onCameraOn:H,formats:["qr_code"],class:"w-full h-full"},{default:w(()=>[!S.value&&!i.value?(t(),o("div",be,e[2]||(e[2]=[a("p",{class:"text-gray-500 dark:text-gray-400"},"Initializing camera...",-1)]))):u("",!0)]),_:1},8,["paused"])):u("",!0)]),a("div",ye,[e[5]||(e[5]=a("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"},"Scan Status",-1)),a("div",_e,[e[3]||(e[3]=a("h4",{class:"font-medium text-blue-900 dark:text-blue-100 mb-2"},"Debug Info:",-1)),a("div",ke,[a("div",null,"🔒 HTTPS: "+l(R.value?"Yes":"No"),1),a("div",null,"🎥 Camera API: "+l(M.value?"Available":"Not Available"),1),a("div",null,"🔐 Secure Context: "+l(D.value?"Yes":"No"),1),a("div",null,"👤 Role: "+l(b(v).user_role),1),a("div",null,"🛡️ Platform Admin: "+l(g.value?"Yes":"No"),1),a("div",null,"📷 Scanner Ready: "+l(S.value?"Yes":"No"),1),a("div",null,"❌ Camera Error: "+l(i.value?"Yes":"No"),1),a("div",null,"🔄 Should Show Scanner: "+l(x.value?"Yes":"No"),1)])]),c.value&&!n.value&&!r.bookingDetails&&!k.value?(t(),o("div",he,e[4]||(e[4]=[a("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[a("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),a("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),C(" Processing QR code... ")]))):u("",!0),(m=n.value)!=null&&m.success?(t(),o("div",xe,l(n.value.success),1)):u("",!0),(d=n.value)!=null&&d.error?(t(),o("div",we,l(n.value.error),1)):u("",!0),!h.value&&!n.value&&!c.value&&!k.value&&x.value?(t(),o("div",Ce," Point the camera at a QR code to scan. ")):!h.value&&!n.value&&!c.value&&!k.value&&!x.value?(t(),o("div",Se,[N.value&&!y.value&&!g.value?(t(),o("span",Ee,"Select an event to begin scanning.")):(t(),o("span",Pe,"Scanner is idle."))])):u("",!0)])]),a("div",Ne,[f(F,{onClick:O,class:"bg-blue-600 hover:bg-blue-700"},{default:w(()=>e[6]||(e[6]=[C(" Test Camera Access ")])),_:1}),f(F,{onClick:z,disabled:c.value&&!E.value},{default:w(()=>e[7]||(e[7]=[C(" Reset Scanner ")])),_:1},8,["disabled"])])])])]),f(te,{show:_.value},null,8,["show"])]}),_:1})],64))}});export{Ge as default};
