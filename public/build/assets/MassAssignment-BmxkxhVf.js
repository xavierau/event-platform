import{d as se,s as m,C as oe,c as _,B as L,a as n,o as i,b as U,e as l,m as re,w as F,f as e,i as u,P as ne,g as V,j as b,k as S,v as T,F as w,r as k,t as a,l as ie,D as ae}from"./app-CBcdSYGl.js";import{_ as le}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cykr0hji.js";import{_ as de}from"./PageHeader.vue_vue_type_script_setup_true_lang-BUVGkEvy.js";import{l as ue}from"./lodash-CuiMI1Jc.js";import"./index-BH95GTik.js";import"./index-B_RuNNQq.js";import"./useForwardPropsEmits-BUmNaTt4.js";import"./useForwardExpose-2b0zYAwj.js";import"./useFocusGuards-BRQO_hst.js";import"./Teleport-BsQYp6hP.js";import"./VisuallyHidden-dajNmunB.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-CPh5rXLj.js";import"./RovingFocusGroup-3mJjWm0y.js";import"./createLucideIcon-dtD6wVEP.js";import"./x-Br0THnaC.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-C3rar4t_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-C_yoBaOs.js";const ce={class:"py-12"},ge={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},me={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},pe={class:"p-6 lg:p-8 bg-white dark:bg-gray-800"},ye={class:"mb-8"},xe={class:"flex items-center justify-center"},ve={class:"flex items-center space-x-4"},fe={class:"flex items-center"},be={class:"flex items-center"},he={class:"flex items-center"},_e={key:0,class:"space-y-6"},we={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ke=["value"],Ce={key:0,class:"space-y-4"},Se={class:"flex justify-between items-center"},Ae={key:0,class:"text-center py-4"},je={key:1,class:"text-center py-4 text-gray-500"},Ue={key:2,class:"max-h-60 overflow-y-auto border border-gray-200 rounded-md"},Te=["onClick"],$e={class:"font-medium text-gray-900"},qe={class:"text-sm text-gray-600"},Ne={class:"text-xs text-gray-500"},Oe={key:0,class:"text-green-600"},Ee={key:1,class:"space-y-4"},Fe={class:"flex justify-between items-center"},Ve={class:"font-medium text-gray-900 dark:text-white"},ze={class:"max-h-40 overflow-y-auto border border-gray-200 rounded-md"},Me={class:"font-medium text-gray-900"},Be={class:"text-sm text-gray-600 ml-2"},Re=["onClick"],Pe={key:0,class:"bg-gray-50 p-4 rounded-md"},De={class:"grid grid-cols-3 gap-4 text-sm"},He={class:"font-medium ml-1"},Ie={class:"font-medium ml-1"},Ke={class:"font-medium ml-1"},Le={class:"flex justify-end"},Xe=["disabled"],Je={key:1,class:"space-y-6"},Qe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},Ge=["onClick"],We={class:"space-y-2"},Ye={class:"flex justify-between items-start"},Ze={class:"font-medium text-gray-900"},et={key:0,class:"text-indigo-600"},tt={class:"text-sm text-gray-600"},st={class:"font-mono"},ot={class:"text-sm text-gray-600"},rt={class:"capitalize"},nt={class:"text-sm text-gray-600"},it={class:"flex justify-between"},at=["disabled"],lt={key:2,class:"space-y-6"},dt={class:"bg-gray-50 p-6 rounded-lg space-y-4"},ut={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ct={key:0,class:"space-y-1"},gt={class:"font-medium"},mt={class:"text-sm text-gray-600"},pt={class:"text-sm text-gray-600"},yt={class:"text-sm text-gray-600"},xt={class:"font-medium"},vt={class:"space-y-4"},ft={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},bt={key:0,class:"text-red-600 text-sm mt-1"},ht={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},_t={class:"list-disc list-inside text-red-700 text-sm space-y-1"},wt={class:"flex justify-between"},kt=["disabled"],Ct={key:0},St={key:1},At={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},jt={class:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto"},Ut={class:"flex justify-between items-start mb-4"},Tt={class:"overflow-x-auto"},$t={class:"min-w-full divide-y divide-gray-200"},qt={class:"bg-white divide-y divide-gray-200"},Nt={class:"px-6 py-4 whitespace-nowrap"},Ot={class:"text-sm font-medium text-gray-900"},Et={class:"text-sm text-gray-500"},Ft={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600"},zt={class:"px-6 py-4 whitespace-nowrap"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Bt={class:"text-xs"},rs=se({__name:"MassAssignment",props:{coupons:{},organizers:{},preSelectedCouponId:{},preSelectedCoupon:{}},setup(X){const y=X,x=m(1),h=m(""),A=m(""),v=m([]),d=m([]),p=m(y.preSelectedCoupon||null),f=m(null),$=m(!1),z=m(!1),q=m(!1),M=m([]),r=oe({coupon_id:y.preSelectedCouponId||null,user_ids:[],quantity:1,expires_at:"",notes:"",processing:!1,errors:{}}),B=_(()=>d.value.map(o=>o.id)),J=_(()=>y.preSelectedCoupon?`Mass Assign: ${y.preSelectedCoupon.name}`:"Mass Coupon Assignment"),Q=_(()=>y.preSelectedCoupon?`Assign "${y.preSelectedCoupon.code}" to multiple users at once`:"Assign coupons to multiple users at once"),N=_(()=>d.value.length>0),O=_(()=>p.value!==null),E=_(()=>r.coupon_id&&r.user_ids.length>0&&r.quantity>0),R=_(()=>d.value.length*r.quantity),P=ue.debounce(async()=>{var o;if(h.value.length<2){v.value=[];return}$.value=!0;try{const s=await(await fetch(route("admin.coupon-assignment.search-users"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({search:h.value,organizer_id:A.value||null,limit:50})})).json();v.value=s.users||[]}catch(t){console.error("Search failed:",t),v.value=[]}finally{$.value=!1}},300),D=o=>{d.value.find(t=>t.id===o.id)||(d.value.push(o),H())},G=o=>{d.value=d.value.filter(t=>t.id!==o),H()},W=()=>{v.value.forEach(o=>D(o))},Y=()=>{d.value=[],f.value=null},H=async()=>{var o;if(d.value.length===0){f.value=null;return}z.value=!0;try{const s=await(await fetch(route("admin.coupon-assignment.user-stats"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({user_ids:B.value})})).json();f.value=s}catch(t){console.error("Failed to load user stats:",t)}finally{z.value=!1}},Z=o=>{p.value=o,r.coupon_id=o.id},j=o=>{o===2&&!N.value||o===3&&!O.value||(x.value=o,o===3&&(r.user_ids=B.value))},ee=async()=>{var o,t,s,g,C;if(E.value){r.processing=!0;try{const c=await ae.post(route("admin.coupon-assignment.assign"),{coupon_id:r.coupon_id,user_ids:r.user_ids,quantity:r.quantity,expires_at:r.expires_at,notes:r.notes},{headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}});c.data.success?(x.value=1,d.value=[],p.value=y.preSelectedCoupon||null,r.reset(),r.coupon_id=y.preSelectedCouponId||null,r.errors={},f.value=null,alert(`Success: ${c.data.message}`),console.log("Assignment successful:",c.data)):alert(`Error: ${c.data.message}`)}catch(c){console.error("Assignment failed:",c),(s=(t=c.response)==null?void 0:t.data)!=null&&s.errors?Object.keys(c.response.data.errors).forEach(K=>{r.errors[K]=c.response.data.errors[K][0]}):(C=(g=c.response)==null?void 0:g.data)!=null&&C.message?alert(`Error: ${c.response.data.message}`):alert("An unexpected error occurred during assignment.")}finally{r.processing=!1}}},te=async()=>{try{const t=await(await fetch(route("admin.coupon-assignment.history"),{method:"GET",headers:{"Content-Type":"application/json"}})).json();M.value=t.assignments||[],q.value=!0}catch(o){console.error("Failed to load history:",o)}},I=(o,t)=>t==="percentage"?`${o}%`:`$${(o/100).toFixed(2)}`;return L(h,P),L(A,P),(o,t)=>(i(),n("div",null,[U(l(re),{title:"Mass Coupon Assignment"}),U(le,null,{default:F(()=>[e("div",ce,[e("div",ge,[e("div",me,[e("div",pe,[U(de,{title:J.value,subtitle:Q.value},{actions:F(()=>[e("button",{onClick:te,class:"inline-flex items-center px-4 py-2 bg-gray-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-500 focus:outline-none focus:border-gray-700 focus:ring focus:ring-gray-200 disabled:opacity-25 transition mr-3"}," View History "),U(l(ne),{href:o.route("admin.coupons.index"),class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:ring focus:ring-indigo-200 disabled:opacity-25 transition"},{default:F(()=>t[10]||(t[10]=[V(" Back to Coupons ")])),_:1},8,["href"])]),_:1},8,["title","subtitle"]),e("div",ye,[e("div",xe,[e("div",ve,[e("div",fe,[e("div",{class:b(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",x.value>=1?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 1 ",2),t[11]||(t[11]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Select Users",-1))]),t[14]||(t[14]=e("div",{class:"w-12 h-1 bg-gray-300 rounded"},null,-1)),e("div",be,[e("div",{class:b(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",x.value>=2?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 2 ",2),t[12]||(t[12]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Choose Coupon",-1))]),t[15]||(t[15]=e("div",{class:"w-12 h-1 bg-gray-300 rounded"},null,-1)),e("div",he,[e("div",{class:b(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",x.value>=3?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 3 ",2),t[13]||(t[13]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Confirm & Assign",-1))])])])]),x.value===1?(i(),n("div",_e,[t[25]||(t[25]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 1: Select Users",-1)),e("div",we,[e("div",null,[t[16]||(t[16]=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Search Users",-1)),S(e("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),type:"text",placeholder:"Search by name or email...",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[T,h.value]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"organizer",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Filter by Organizer",-1)),S(e("select",{id:"organizer","onUpdate:modelValue":t[1]||(t[1]=s=>A.value=s),class:"mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[t[17]||(t[17]=e("option",{value:""},"All Organizers",-1)),(i(!0),n(w,null,k(o.organizers,s=>(i(),n("option",{key:s.id,value:s.id},a(s.name),9,ke))),128))],512),[[ie,A.value]])])]),h.value.length>=2?(i(),n("div",Ce,[e("div",Se,[t[19]||(t[19]=e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Search Results",-1)),v.value.length>0?(i(),n("button",{key:0,onClick:W,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Select All ("+a(v.value.length)+") ",1)):u("",!0)]),$.value?(i(),n("div",Ae,t[20]||(t[20]=[e("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"},null,-1),e("span",{class:"ml-2 text-sm text-gray-600"},"Searching...",-1)]))):v.value.length===0&&h.value.length>=2?(i(),n("div",je," No users found matching your search. ")):(i(),n("div",Ue,[(i(!0),n(w,null,k(v.value,s=>(i(),n("div",{key:s.id,class:"p-3 border-b border-gray-200 hover:bg-gray-50 cursor-pointer flex justify-between items-center",onClick:g=>D(s)},[e("div",null,[e("div",$e,a(s.name),1),e("div",qe,a(s.email),1),e("div",Ne,"Member since "+a(s.member_since),1)]),d.value.find(g=>g.id===s.id)?(i(),n("div",Oe," ✓ Selected ")):u("",!0)],8,Te))),128))]))])):u("",!0),d.value.length>0?(i(),n("div",Ee,[e("div",Fe,[e("h4",Ve,"Selected Users ("+a(d.value.length)+")",1),e("button",{onClick:Y,class:"text-sm text-red-600 hover:text-red-800"}," Clear All ")]),e("div",ze,[(i(!0),n(w,null,k(d.value,s=>(i(),n("div",{key:s.id,class:"p-2 border-b border-gray-200 flex justify-between items-center"},[e("div",null,[e("span",Me,a(s.name),1),e("span",Be,a(s.email),1)]),e("button",{onClick:g=>G(s.id),class:"text-red-600 hover:text-red-800 text-sm"}," Remove ",8,Re)]))),128))]),f.value?(i(),n("div",Pe,[t[24]||(t[24]=e("h5",{class:"font-medium text-gray-900 mb-2"},"Selected User Statistics",-1)),e("div",De,[e("div",null,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Total Users:",-1)),e("span",He,a(f.value.total_users),1)]),e("div",null,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"Active Users:",-1)),e("span",Ie,a(f.value.active_users),1)]),e("div",null,[t[23]||(t[23]=e("span",{class:"text-gray-600"},"With Coupons:",-1)),e("span",Ke,a(f.value.users_with_coupons),1)])])])):u("",!0)])):u("",!0),e("div",Le,[e("button",{onClick:t[2]||(t[2]=s=>j(2)),disabled:!N.value,class:b(["px-4 py-2 rounded-md font-semibold text-sm",N.value?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Next: Choose Coupon ",10,Xe)])])):u("",!0),x.value===2?(i(),n("div",Je,[t[28]||(t[28]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 2: Choose Coupon",-1)),e("div",Qe,[(i(!0),n(w,null,k(o.coupons,s=>{var g,C;return i(),n("div",{key:s.id,class:b(["border-2 rounded-lg p-4 cursor-pointer transition-colors",((g=p.value)==null?void 0:g.id)===s.id?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"]),onClick:c=>Z(s)},[e("div",We,[e("div",Ye,[e("h4",Ze,a(s.name),1),((C=p.value)==null?void 0:C.id)===s.id?(i(),n("div",et," ✓ ")):u("",!0)]),e("div",tt,[t[26]||(t[26]=V(" Code: ")),e("span",st,a(s.code),1)]),e("div",ot,[t[27]||(t[27]=V(" Type: ")),e("span",rt,a(s.type.replace("_"," ")),1)]),e("div",nt," Discount: "+a(I(s.discount_value,s.discount_type)),1)])],10,Ge)}),128))]),e("div",it,[e("button",{onClick:t[3]||(t[3]=s=>j(1)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Back: Select Users "),e("button",{onClick:t[4]||(t[4]=s=>j(3)),disabled:!O.value,class:b(["px-4 py-2 rounded-md font-semibold text-sm",O.value?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Next: Confirm Assignment ",10,at)])])):u("",!0),x.value===3?(i(),n("div",lt,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 3: Confirm & Assign",-1)),e("div",dt,[t[31]||(t[31]=e("h4",{class:"font-medium text-gray-900"},"Assignment Summary",-1)),e("div",ut,[e("div",null,[t[29]||(t[29]=e("h5",{class:"text-sm font-medium text-gray-700 mb-2"},"Selected Coupon",-1)),p.value?(i(),n("div",ct,[e("div",gt,a(p.value.name),1),e("div",mt,"Code: "+a(p.value.code),1),e("div",pt," Discount: "+a(I(p.value.discount_value,p.value.discount_type)),1)])):u("",!0)]),e("div",null,[t[30]||(t[30]=e("h5",{class:"text-sm font-medium text-gray-700 mb-2"},"Recipients",-1)),e("div",yt,[e("div",null,a(d.value.length)+" users selected",1),e("div",null,a(l(r).quantity)+" coupon(s) per user",1),e("div",xt,"Total: "+a(R.value)+" coupons",1)])])])]),e("div",vt,[e("div",ft,[e("div",null,[t[32]||(t[32]=e("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity per User",-1)),S(e("input",{id:"quantity","onUpdate:modelValue":t[5]||(t[5]=s=>l(r).quantity=s),type:"number",min:"1",max:"10",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[T,l(r).quantity,void 0,{number:!0}]]),l(r).errors.quantity?(i(),n("div",bt,a(l(r).errors.quantity),1)):u("",!0)]),e("div",null,[t[33]||(t[33]=e("label",{for:"expires_at",class:"block text-sm font-medium text-gray-700"},"Custom Expiry (Optional)",-1)),S(e("input",{id:"expires_at","onUpdate:modelValue":t[6]||(t[6]=s=>l(r).expires_at=s),type:"datetime-local",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[T,l(r).expires_at]])])]),e("div",null,[t[34]||(t[34]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes (Optional)",-1)),S(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=s=>l(r).notes=s),rows:"3",placeholder:"Add any notes about this assignment...",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[T,l(r).notes]])])]),Object.keys(l(r).errors).length>0?(i(),n("div",ht,[t[35]||(t[35]=e("h4",{class:"text-red-800 font-medium mb-2"},"Please fix the following errors:",-1)),e("ul",_t,[(i(!0),n(w,null,k(l(r).errors,(s,g)=>(i(),n("li",{key:g},a(s),1))),128))])])):u("",!0),e("div",wt,[e("button",{onClick:t[8]||(t[8]=s=>j(2)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Back: Choose Coupon "),e("button",{onClick:ee,disabled:!E.value||l(r).processing,class:b(["px-6 py-2 rounded-md font-semibold text-sm",E.value&&!l(r).processing?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])},[l(r).processing?(i(),n("span",Ct,"Assigning...")):(i(),n("span",St,"Assign "+a(R.value)+" Coupons",1))],10,kt)])])):u("",!0)])])])]),q.value?(i(),n("div",At,[e("div",jt,[e("div",Ut,[t[38]||(t[38]=e("h3",{class:"text-lg font-semibold"},"Assignment History",-1)),e("button",{onClick:t[9]||(t[9]=s=>q.value=!1),class:"text-gray-400 hover:text-gray-600"},t[37]||(t[37]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",Tt,[e("table",$t,[t[39]||(t[39]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"User"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Coupon"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Code"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned")])],-1)),e("tbody",qt,[(i(!0),n(w,null,k(M.value,s=>(i(),n("tr",{key:s.id},[e("td",Nt,[e("div",Ot,a(s.user_name),1),e("div",Et,a(s.user_email),1)]),e("td",Ft,a(s.coupon_name),1),e("td",Vt,a(s.unique_code),1),e("td",zt,[e("span",{class:b(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},a(s.status),3)]),e("td",Mt,[e("div",null,a(s.assigned_at),1),e("div",Bt,"by "+a(s.assigned_by),1)])]))),128))])])])])])):u("",!0)]),_:1})]))}});export{rs as default};
