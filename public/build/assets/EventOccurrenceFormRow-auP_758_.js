import{d as ee,I as te,J as N,D as j,s as C,c as b,a as m,o as c,f as o,b as l,t as g,w as r,g as a,e as s,F as $,r as V,i as J,h as U,j as ie,p as le,k as se,E as ne}from"./app-BlriFIqe.js";import{_ as S}from"./index-n8QSRl2p.js";import{_ as f}from"./Label.vue_vue_type_script_setup_true_lang-XssgAD5J.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-Ds4BPUgy.js";import{_ as oe}from"./Checkbox.vue_vue_type_script_setup_true_lang-DTYWBEh0.js";import{_ as p}from"./InputError.vue_vue_type_script_setup_true_lang-Cyvqxqv2.js";import{c as re}from"./i18n-DEP6uGVt.js";import{_ as ae}from"./Textarea.vue_vue_type_script_setup_true_lang-CZpKFZxw.js";import{_ as M,a as B,b as R,c as D,d as P}from"./SelectValue.vue_vue_type_script_setup_true_lang-CwazvBhT.js";import{_ as de}from"./TicketDefinitionMiniForm.vue_vue_type_script_setup_true_lang-dbrBqsIA.js";import{_ as ue}from"./TicketDefinitionSelector.vue_vue_type_script_setup_true_lang-CaT65JYv.js";import"./useForwardExpose-CTSY01TP.js";import"./index-Bhpe8JcZ.js";import"./useForwardPropsEmits-BFEAxE1x.js";import"./check-COqelS8a.js";import"./createLucideIcon-C1ebVwtv.js";import"./useFormControl-B_FzSHYT.js";import"./RovingFocusGroup-C8rdEAgk.js";import"./VisuallyHiddenInput-C_tgBnze.js";import"./VisuallyHidden-c1buR7Qf.js";import"./Teleport-XyWxSjNg.js";import"./useFocusGuards-DE3wpZyr.js";import"./DialogTitle.vue_vue_type_script_setup_true_lang-DgI8mb4r.js";import"./x-DhC37dsd.js";import"./DialogClose.vue_vue_type_script_setup_true_lang-3RA3vyFJ.js";import"./DialogDescription.vue_vue_type_script_setup_true_lang-DjOzeiDs.js";const ce={class:"p-4 md:p-6 border rounded-lg shadow space-y-6 mb-6 bg-card text-card-foreground"},me={class:"flex justify-between items-center"},fe={class:"text-lg font-semibold"},pe={class:"border-b border-border mb-4"},_e={class:"-mb-px flex space-x-4","aria-label":"Tabs"},ve=["onClick"],ge={class:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"},ke={class:"md:col-span-2 space-y-2"},ye={class:"flex items-center space-x-2"},be={key:0,class:"md:col-span-2"},$e={class:"mt-6 pt-6 border-t border-border"},Ve={class:"flex justify-between items-center mb-3"},we={class:"space-x-2"},xe={key:0,class:"p-4 border border-dashed rounded-md text-center text-muted-foreground"},Oe={key:1,class:"space-y-4"},Se={class:"flex justify-between items-start mb-2"},Te={class:"font-semibold"},Ne={class:"text-xs text-muted-foreground"},Ce={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},it=ee({__name:"EventOccurrenceFormRow",props:{occurrence:{},index:{},availableVenues:{},availableStatuses:{},availableLocales:{},allAvailableTicketDefinitions:{},ticketDefinitionStatuses:{}},emits:["removeOccurrence","newTicketDefinitionCreated","update:occurrence"],setup(Q,{emit:W}){const _=Q,T=W,n=te(JSON.parse(JSON.stringify(N(_.occurrence))));j(()=>_.occurrence,i=>{Object.assign(n,JSON.parse(JSON.stringify(N(i))))},{deep:!0}),j(n,i=>{T("update:occurrence",JSON.parse(JSON.stringify(N(i))))},{deep:!0});const w=C(!1),x=C(!1),O=b(()=>Object.entries(_.availableLocales).map(([i,e])=>({key:i,label:e}))),y=C(re.value||(O.value.length>0?O.value[0].key:"en")),z=b({get:()=>n.name[y.value]||"",set:i=>{n.name[y.value]=i}}),A=b({get:()=>n.description[y.value]||"",set:i=>{n.description[y.value]=i}}),q=b({get:()=>n.timezone||"",set:i=>{n.timezone=i===""?null:i}}),E=b({get:()=>n.capacity===null||n.capacity===void 0?"":n.capacity.toString(),set:i=>{const e=parseInt(i,10);n.capacity=isNaN(e)?null:e}}),h=b({get:()=>n.online_meeting_link||"",set:i=>{n.online_meeting_link=i===""?null:i}}),Y=()=>{T("removeOccurrence",_.index)},v=i=>{var t;const e=`${i}`;return(t=n.errors)==null?void 0:t[e]},F=(i,e)=>{var d;const t=`${i}.${e}`;return(d=n.errors)==null?void 0:d[t]},G=i=>{T("newTicketDefinitionCreated",i),w.value=!1},H=i=>{const e=[];i.forEach(t=>{const d=n.assigned_tickets.find(u=>u.ticket_definition_id===t);if(d)e.push(d);else{const u=_.allAvailableTicketDefinitions.find(I=>I.id===t);e.push({ticket_definition_id:t,name:u==null?void 0:u.name,original_price:u==null?void 0:u.price,original_currency_code:u==null?void 0:u.currency_code,quantity_for_occurrence:void 0,price_override:void 0})}}),n.assigned_tickets=e,x.value=!1},K=i=>{n.assigned_tickets=n.assigned_tickets.filter(e=>e.ticket_definition_id!==i)},X=i=>{var e;return((e=_.allAvailableTicketDefinitions.find(t=>t.id===i))==null?void 0:e.name)||"Unknown Ticket"},Z=(i,e)=>{if(i==null||!e)return"N/A";try{return new Intl.NumberFormat(void 0,{style:"currency",currency:e}).format(i/100)}catch{return`${(i/100).toFixed(2)} ${e}`}},L=(i,e)=>{var t;return(t=n.errors)==null?void 0:t[`assigned_tickets.${i}.${e}`]};return(i,e)=>(c(),m("div",ce,[o("div",me,[o("h3",fe,"Event Occurrence #"+g(i.index+1),1),l(s(S),{type:"button",variant:"destructive",onClick:Y,size:"sm"},{default:r(()=>e[14]||(e[14]=[a(" Remove Occurrence ")])),_:1})]),o("div",pe,[o("nav",_e,[(c(!0),m($,null,V(O.value,t=>(c(),m("button",{key:t.key,onClick:le(d=>y.value=t.key,["prevent"]),class:ie([y.value===t.key?"border-primary text-primary":"border-transparent text-muted-foreground hover:text-foreground hover:border-border","whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm focus:outline-none"]),type:"button"},g(t.label),11,ve))),128))])]),(c(!0),m($,null,V(O.value,t=>se((c(),m("div",{key:t.key,class:"space-y-4"},[o("div",null,[l(s(f),{for:`occurrence_name_${i.index}_${t.key}`},{default:r(()=>[a("Occurrence Name ("+g(t.label)+") ",1),e[15]||(e[15]=o("span",{class:"text-xs text-muted-foreground"},"(Optional)",-1))]),_:2},1032,["for"]),l(s(k),{id:`occurrence_name_${i.index}_${t.key}`,type:"text",modelValue:z.value,"onUpdate:modelValue":e[0]||(e[0]=d=>z.value=d),class:"mt-1 block w-full",placeholder:"e.g., Afternoon Session, Day 1 Workshop"},null,8,["id","modelValue"]),l(p,{message:F("name",t.key),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_description_${i.index}_${t.key}`},{default:r(()=>[a("Occurrence Description ("+g(t.label)+") ",1),e[16]||(e[16]=o("span",{class:"text-xs text-muted-foreground"},"(Optional)",-1))]),_:2},1032,["for"]),l(s(ae),{id:`occurrence_description_${i.index}_${t.key}`,modelValue:A.value,"onUpdate:modelValue":e[1]||(e[1]=d=>A.value=d),rows:"3",class:"mt-1 block w-full",placeholder:"Specific details for this occurrence..."},null,8,["id","modelValue"]),l(p,{message:F("description",t.key),class:"mt-1"},null,8,["message"])])])),[[ne,y.value===t.key]])),128)),o("div",ge,[o("div",null,[l(s(f),{for:`occurrence_venue_${i.index}`,required:""},{default:r(()=>e[17]||(e[17]=[a("Venue")])),_:1},8,["for"]),l(s(P),{modelValue:n.venue_id,"onUpdate:modelValue":e[2]||(e[2]=t=>n.venue_id=t)},{default:r(()=>[l(s(M),{id:`occurrence_venue_${i.index}`,class:"mt-1 w-full"},{default:r(()=>[l(s(B),{placeholder:"Select a venue"})]),_:1},8,["id"]),l(s(R),null,{default:r(()=>[!i.availableVenues||i.availableVenues.length===0?(c(),U(s(D),{key:0,value:null,disabled:""},{default:r(()=>e[18]||(e[18]=[a(" No venues available ")])),_:1})):J("",!0),(c(!0),m($,null,V(i.availableVenues,t=>(c(),U(s(D),{key:t.id,value:t.id},{default:r(()=>[a(g(t.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),l(p,{message:v("venue_id"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_status_${i.index}`,required:""},{default:r(()=>e[19]||(e[19]=[a("Status")])),_:1},8,["for"]),l(s(P),{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=t=>n.status=t)},{default:r(()=>[l(s(M),{id:`occurrence_status_${i.index}`,class:"mt-1 w-full"},{default:r(()=>[l(s(B),{placeholder:"Select status"})]),_:1},8,["id"]),l(s(R),null,{default:r(()=>[(c(!0),m($,null,V(i.availableStatuses,t=>(c(),U(s(D),{key:t.value,value:t.value},{default:r(()=>[a(g(t.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),l(p,{message:v("status"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_start_at_${i.index}`,required:""},{default:r(()=>e[20]||(e[20]=[a("Start Date & Time")])),_:1},8,["for"]),l(s(k),{id:`occurrence_start_at_${i.index}`,type:"datetime-local",modelValue:n.start_at,"onUpdate:modelValue":e[4]||(e[4]=t=>n.start_at=t),class:"mt-1 block w-full"},null,8,["id","modelValue"]),l(p,{message:v("start_at"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_end_at_${i.index}`,required:""},{default:r(()=>e[21]||(e[21]=[a("End Date & Time")])),_:1},8,["for"]),l(s(k),{id:`occurrence_end_at_${i.index}`,type:"datetime-local",modelValue:n.end_at,"onUpdate:modelValue":e[5]||(e[5]=t=>n.end_at=t),class:"mt-1 block w-full"},null,8,["id","modelValue"]),l(p,{message:v("end_at"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_timezone_${i.index}`},{default:r(()=>e[22]||(e[22]=[a("Timezone")])),_:1},8,["for"]),l(s(k),{id:`occurrence_timezone_${i.index}`,type:"text",modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=t=>q.value=t),class:"mt-1 block w-full",placeholder:"e.g., America/New_York or UTC"},null,8,["id","modelValue"]),l(p,{message:v("timezone"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`occurrence_capacity_${i.index}`},{default:r(()=>e[23]||(e[23]=[a("Capacity "),o("span",{class:"text-xs text-muted-foreground"},"(Optional)",-1)])),_:1},8,["for"]),l(s(k),{id:`occurrence_capacity_${i.index}`,type:"number",modelValue:E.value,"onUpdate:modelValue":e[7]||(e[7]=t=>E.value=t),class:"mt-1 block w-full",placeholder:"e.g., 100",min:"0"},null,8,["id","modelValue"]),l(p,{message:v("capacity"),class:"mt-1"},null,8,["message"])]),o("div",ke,[o("div",ye,[l(s(oe),{id:`occurrence_is_online_${i.index}`,checked:n.is_online,"onUpdate:checked":e[8]||(e[8]=t=>n.is_online=t)},null,8,["id","checked"]),l(s(f),{for:`occurrence_is_online_${i.index}`,class:"font-normal"},{default:r(()=>e[24]||(e[24]=[a("This occurrence is online")])),_:1},8,["for"])]),l(p,{message:v("is_online"),class:"mt-1"},null,8,["message"])]),n.is_online?(c(),m("div",be,[l(s(f),{for:`occurrence_online_link_${i.index}`},{default:r(()=>e[25]||(e[25]=[a("Online Meeting Link")])),_:1},8,["for"]),l(s(k),{id:`occurrence_online_link_${i.index}`,type:"url",modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=t=>h.value=t),class:"mt-1 block w-full",placeholder:"e.g., https://zoom.us/j/..."},null,8,["id","modelValue"]),l(p,{message:v("online_meeting_link"),class:"mt-1"},null,8,["message"])])):J("",!0)]),o("div",$e,[o("div",Ve,[e[28]||(e[28]=o("h4",{class:"text-md font-semibold"},"Tickets for this Occurrence",-1)),o("div",we,[l(s(S),{type:"button",variant:"outline",size:"sm",onClick:e[10]||(e[10]=t=>x.value=!0)},{default:r(()=>e[26]||(e[26]=[a(" Assign Tickets ")])),_:1}),l(s(S),{type:"button",variant:"outline",size:"sm",onClick:e[11]||(e[11]=t=>w.value=!0)},{default:r(()=>e[27]||(e[27]=[a(" Create New Ticket Type ")])),_:1})])]),!n.assigned_tickets||n.assigned_tickets.length===0?(c(),m("div",xe," No tickets assigned to this specific occurrence yet. ")):(c(),m("div",Oe,[(c(!0),m($,null,V(n.assigned_tickets,(t,d)=>(c(),m("div",{key:t.ticket_definition_id,class:"p-4 border rounded-md bg-muted/30"},[o("div",Se,[o("div",null,[o("h5",Te,g(t.name||X(t.ticket_definition_id)),1),o("p",Ne," Original Price: "+g(Z(t.original_price,t.original_currency_code)),1)]),l(s(S),{type:"button",variant:"ghost",size:"sm",onClick:u=>K(t.ticket_definition_id),class:"text-destructive hover:text-destructive-hover"},{default:r(()=>e[29]||(e[29]=[a(" Remove ")])),_:2},1032,["onClick"])]),o("div",Ce,[o("div",null,[l(s(f),{for:`assigned_ticket_qty_${i.index}_${d}`},{default:r(()=>e[30]||(e[30]=[a("Quantity for this Occurrence")])),_:2},1032,["for"]),l(s(k),{id:`assigned_ticket_qty_${i.index}_${d}`,type:"number",modelValue:t.quantity_for_occurrence,"onUpdate:modelValue":u=>t.quantity_for_occurrence=u,modelModifiers:{number:!0},placeholder:"Unlimited",class:"mt-1 block w-full",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l(p,{message:L(d,"quantity_for_occurrence"),class:"mt-1"},null,8,["message"])]),o("div",null,[l(s(f),{for:`assigned_ticket_price_override_${i.index}_${d}`},{default:r(()=>e[31]||(e[31]=[a("Price Override (in cents)")])),_:2},1032,["for"]),l(s(k),{id:`assigned_ticket_price_override_${i.index}_${d}`,type:"number",modelValue:t.price_override,"onUpdate:modelValue":u=>t.price_override=u,modelModifiers:{number:!0},placeholder:"Use original price",class:"mt-1 block w-full",min:"0"},null,8,["id","modelValue","onUpdate:modelValue"]),l(p,{message:L(d,"price_override"),class:"mt-1"},null,8,["message"])])])]))),128))]))]),l(de,{show:w.value,statuses:_.ticketDefinitionStatuses,"available-locales":_.availableLocales,onClose:e[12]||(e[12]=t=>w.value=!1),onTicketDefinitionCreated:G},null,8,["show","statuses","available-locales"]),l(ue,{show:x.value,"available-ticket-definitions":_.allAvailableTicketDefinitions,"initially-selected-ids":n.assigned_tickets.map(t=>t.ticket_definition_id),onClose:e[13]||(e[13]=t=>x.value=!1),onTicketDefinitionsSelected:H},null,8,["show","available-ticket-definitions","initially-selected-ids"])]))}});export{it as default};
