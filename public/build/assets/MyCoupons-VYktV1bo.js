import{d as H,s as u,a as o,o as a,b as M,f as e,i as l,e as R,m as W,w as G,g as j,P as q,t as d,F as p,r as _,k as I,v as Q,_ as U,j as v,W as T,h as J}from"./app-_LMAJuVE.js";import{d as E}from"./dayjs.min-BYdALWVn.js";import{u as X}from"./utc-D2B1stg6.js";import{Q as Z}from"./browser-BIJ6lEpp.js";import{_ as ee}from"./FrontendFooter.vue_vue_type_script_setup_true_lang-DTWjt7Az.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"min-h-screen bg-gray-100 dark:bg-gray-900"},re={class:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-50 border-b dark:border-gray-700"},ae={class:"container mx-auto flex items-center p-4 relative"},oe={class:"container mx-auto py-6 px-4 pb-24"},de={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"},le={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ne={class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},ie={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ue={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ce={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},ge={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},ye={class:"bg-white dark:bg-gray-800 rounded-lg shadow p-6"},xe={class:"text-2xl font-bold text-gray-600 dark:text-gray-400"},be={class:"bg-white dark:bg-gray-800 rounded-lg shadow mb-6"},me={class:"p-6 border-b border-gray-200 dark:border-gray-700"},ve={class:"flex flex-wrap gap-2 mb-4"},fe=["onClick"],he={class:"flex gap-4"},ke={class:"flex-1"},pe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},_e={class:"p-6 border-b border-gray-200 dark:border-gray-700"},we={class:"flex justify-between items-start mb-2"},Ce={class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},Pe={class:"text-gray-600 dark:text-gray-400 text-sm mb-3"},Me={class:"text-sm text-gray-500 dark:text-gray-400"},Re={class:"font-mono"},je={key:0},Ne={class:"p-6"},Fe={class:"flex flex-wrap gap-2"},Se=["onClick","disabled"],qe=["onClick","disabled"],Ie={key:0,class:"mt-4 pt-4 border-t border-gray-200"},Qe={class:"space-y-1"},Ue={key:0},Te={key:1,class:"text-center py-12"},Ee={class:"text-gray-600"},$e={key:2,class:"flex justify-center"},Ae={class:"flex space-x-2"},Be={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},De={class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4"},Oe={class:"flex justify-between items-start mb-4"},Le={key:0,class:"text-center"},Ve={class:"mb-4"},Ye={class:"font-medium text-gray-900 dark:text-gray-100"},ze={class:"text-sm text-gray-600 dark:text-gray-400"},Ke={class:"w-64 h-64 mx-auto bg-white border border-gray-200 dark:border-gray-600 rounded-lg flex items-center justify-center mb-4"},He=["src"],We={key:1,class:"text-center"},Ge={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Je={class:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4"},Xe={class:"flex justify-between items-start mb-4"},Ze={key:0,class:"text-center"},et={class:"mb-6"},tt={class:"font-medium text-gray-900 dark:text-gray-100"},st={class:"text-sm text-gray-600 dark:text-gray-400"},rt={class:"space-y-4"},at=["disabled"],ot={key:0,class:"text-red-600 dark:text-red-400 text-sm text-center"},dt=["disabled"],lt={key:0},nt={key:1},it=H({__name:"MyCoupons",props:{coupons:{type:Object,required:!0},statistics:{type:Object,required:!0},filters:{type:Object,required:!0}},setup(n){E.extend(X);const b=n,m=u(b.filters.search||""),w=u(b.filters.status||"all"),C=u(!1),f=u(!1),i=u(null),h=u(""),c=u(""),g=u(!1),y=u(""),$=[{key:"all",label:"All Coupons",count:b.statistics.total},{key:"active",label:"Active",count:b.statistics.active},{key:"expired",label:"Expired",count:b.statistics.expired},{key:"used",label:"Fully Used",count:b.statistics.fully_used}];function A(r){w.value=r,P()}function P(){T.get("/my-coupons",{status:w.value,search:m.value||void 0},{preserveState:!0,replace:!0})}function N(){P()}function B(){m.value="",P()}async function D(r){i.value=r;try{const t=await Z.toDataURL(r.unique_code,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});h.value=t}catch(t){console.error("Error generating QR code:",t),h.value=""}C.value=!0}function O(r){i.value=r,c.value="",y.value="",g.value=!1,f.value=!0}async function F(){var r;if(!(!i.value||!c.value)){if(c.value.length!==6){y.value="PIN must be exactly 6 digits";return}g.value=!0,y.value="";try{const s=await(await fetch("/api/v1/coupons/redeem-by-pin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""},body:JSON.stringify({unique_code:i.value.unique_code,merchant_pin:c.value,location:"User Device - My Coupons"})})).json();s.success?(f.value=!1,T.reload()):y.value=s.message||"Invalid PIN. Please try again."}catch(t){console.error("PIN redemption error:",t),y.value="An error occurred. Please try again."}finally{g.value=!1}}}function L(r){return r.is_active?"text-green-600 bg-green-100":r.is_expired?"text-yellow-600 bg-yellow-100":(r.is_fully_used,"text-gray-600 bg-gray-100")}function V(r){return r.is_active?"Active":r.is_expired?"Expired":r.is_fully_used?"Fully Used":"Inactive"}function S(r){return E(r).format("MMM D, YYYY h:mm A")}function Y(r){return`${r.times_used} / ${r.times_can_be_used} uses`}function k(r){return r.is_active}function z(r){return r.coupon.redemption_methods.includes("qr")}function K(r){return r.coupon.redemption_methods.includes("pin")}return(r,t)=>(a(),o("div",se,[M(R(W),{title:"My Coupons"}),e("header",re,[e("div",ae,[M(R(q),{href:"/",class:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 absolute left-4"},{default:G(()=>t[4]||(t[4]=[j(" ← Back ")])),_:1}),t[5]||(t[5]=e("h1",{class:"text-xl font-semibold text-gray-900 dark:text-gray-100 flex-1 text-center"},"My Coupons",-1))])]),e("main",oe,[t[14]||(t[14]=e("div",{class:"mb-6"},[e("p",{class:"text-gray-600 dark:text-gray-300 text-center"},"Manage and redeem your coupons")],-1)),e("div",de,[e("div",le,[e("div",ne,d(n.statistics.total),1),t[6]||(t[6]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Total Coupons",-1))]),e("div",ie,[e("div",ue,d(n.statistics.active),1),t[7]||(t[7]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Active",-1))]),e("div",ce,[e("div",ge,d(n.statistics.expired),1),t[8]||(t[8]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Expired",-1))]),e("div",ye,[e("div",xe,d(n.statistics.fully_used),1),t[9]||(t[9]=e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Fully Used",-1))])]),e("div",be,[e("div",me,[e("div",ve,[(a(),o(p,null,_($,s=>e("button",{key:s.key,onClick:x=>A(s.key),class:v(["px-4 py-2 rounded-md text-sm font-medium transition-colors",w.value===s.key?"bg-blue-100 dark:bg-blue-700 text-blue-700 dark:text-blue-200 border border-blue-300 dark:border-blue-600":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},d(s.label)+" ("+d(s.count)+") ",11,fe)),64))]),e("div",he,[e("div",ke,[I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),onKeyup:U(N,["enter"]),type:"text",placeholder:"Search by coupon name, description, or code...",class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,544),[[Q,m.value]])]),e("button",{onClick:N,class:"px-4 py-2 bg-blue-600 dark:bg-blue-700 text-white rounded-md hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors"}," Search "),m.value?(a(),o("button",{key:0,onClick:B,class:"px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors"}," Clear ")):l("",!0)])])]),n.coupons.data.length>0?(a(),o("div",pe,[(a(!0),o(p,null,_(n.coupons.data,s=>(a(),o("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden"},[e("div",_e,[e("div",we,[e("h3",Ce,d(s.coupon.name),1),e("span",{class:v(["px-2 py-1 text-xs font-medium rounded-full",L(s)])},d(V(s)),3)]),e("p",Pe,d(s.coupon.description),1),e("div",Me,[e("div",null,[t[10]||(t[10]=j("Code: ")),e("span",Re,d(s.unique_code),1)]),e("div",null,"Usage: "+d(Y(s)),1),s.expires_at?(a(),o("div",je," Expires: "+d(S(s.expires_at)),1)):l("",!0)])]),e("div",Ne,[e("div",Fe,[z(s)?(a(),o("button",{key:0,onClick:x=>D(s),disabled:!k(s),class:v(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors",k(s)?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Show QR Code ",10,Se)):l("",!0),K(s)?(a(),o("button",{key:1,onClick:x=>O(s),disabled:!k(s),class:v(["flex-1 px-4 py-2 rounded-md text-sm font-medium transition-colors",k(s)?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Redeem by PIN ",10,qe)):l("",!0)]),s.usage_logs.length>0?(a(),o("div",Ie,[t[11]||(t[11]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Recent Usage",-1)),e("div",Qe,[(a(!0),o(p,null,_(s.usage_logs.slice(0,2),x=>(a(),o("div",{key:x.id,class:"text-xs text-gray-600"},[j(d(S(x.created_at))+" ",1),x.location?(a(),o("span",Ue," at "+d(x.location),1)):l("",!0)]))),128))])])):l("",!0)])]))),128))])):(a(),o("div",Te,[t[12]||(t[12]=e("div",{class:"text-gray-400 text-6xl mb-4"},"🎫",-1)),t[13]||(t[13]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"No coupons found",-1)),e("p",Ee,d(m.value?"Try adjusting your search or filters.":"You don't have any coupons yet."),1)])),n.coupons.links&&n.coupons.links.length>3?(a(),o("div",$e,[e("nav",Ae,[(a(!0),o(p,null,_(n.coupons.links,s=>(a(),J(R(q),{key:s.label,href:s.url,class:v(["px-3 py-2 text-sm rounded-md",s.active?"bg-blue-600 text-white":s.url?"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300":"bg-gray-100 text-gray-400 cursor-not-allowed"]),innerHTML:s.label},null,8,["href","class","innerHTML"]))),128))])])):l("",!0)]),M(ee),C.value?(a(),o("div",Be,[e("div",De,[e("div",Oe,[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"QR Code for Redemption",-1)),e("button",{onClick:t[1]||(t[1]=s=>C.value=!1),class:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"},t[15]||(t[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),i.value?(a(),o("div",Le,[e("div",Ve,[e("h4",Ye,d(i.value.coupon.name),1),e("p",ze,d(i.value.unique_code),1)]),e("div",Ke,[h.value?(a(),o("img",{key:0,src:h.value,alt:"QR Code for coupon redemption",class:"w-full h-full object-contain p-2"},null,8,He)):(a(),o("div",We,t[17]||(t[17]=[e("div",{class:"text-gray-400 text-2xl mb-2"},"📱",-1),e("div",{class:"text-sm text-gray-600 dark:text-gray-400"},"Generating QR Code...",-1)])))]),t[18]||(t[18]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Show this QR code to the merchant for scanning",-1))])):l("",!0)])])):l("",!0),f.value?(a(),o("div",Ge,[e("div",Je,[e("div",Xe,[t[20]||(t[20]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"PIN Redemption",-1)),e("button",{onClick:t[2]||(t[2]=s=>f.value=!1),class:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300"},t[19]||(t[19]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),i.value?(a(),o("div",Ze,[e("div",et,[e("h4",tt,d(i.value.coupon.name),1),e("p",st,d(i.value.unique_code),1)]),t[22]||(t[22]=e("div",{class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-6"},[e("div",{class:"text-blue-800 dark:text-blue-200 text-sm"},[e("div",{class:"font-medium mb-2"},"🔐 PIN Redemption Process"),e("ol",{class:"text-left space-y-1 text-xs"},[e("li",null,"1. Hand your device to the merchant"),e("li",null,"2. Merchant enters their 6-digit PIN below"),e("li",null,"3. Coupon will be redeemed automatically")])])],-1)),e("div",rt,[e("div",null,[t[21]||(t[21]=e("label",{for:"merchantPin",class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Merchant PIN (6 digits) ",-1)),I(e("input",{id:"merchantPin","onUpdate:modelValue":t[3]||(t[3]=s=>c.value=s),type:"text",inputmode:"numeric",pattern:"[0-9]{6}",maxlength:"6",placeholder:"Enter 6-digit PIN",class:"w-full px-4 py-3 text-center text-lg font-mono border border-gray-300 dark:border-gray-600 rounded-md focus:ring-2 focus:ring-green-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500",disabled:g.value,onKeyup:U(F,["enter"])},null,40,at),[[Q,c.value]])]),y.value?(a(),o("div",ot,d(y.value),1)):l("",!0),e("button",{onClick:F,disabled:g.value||c.value.length!==6,class:v(["w-full py-3 px-4 rounded-md text-white font-medium transition-colors",[g.value||c.value.length!==6?"bg-gray-400 dark:bg-gray-600 cursor-not-allowed":"bg-green-600 hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-800"]])},[g.value?(a(),o("span",lt,"Processing...")):(a(),o("span",nt,"Redeem Coupon"))],10,dt)])])):l("",!0)])])):l("",!0)]))}}),mt=te(it,[["__scopeId","data-v-e9414972"]]);export{mt as default};
