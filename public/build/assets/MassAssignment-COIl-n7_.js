import{d as oe,s as g,C as re,c as _,B as X,a as n,o as i,b as T,e as l,m as ne,w as V,f as e,i as u,P as ie,g as z,j as f,k as A,v as $,F as k,r as C,t as a,l as ae,D as le}from"./app-_LMAJuVE.js";import{_ as de}from"./AppLayout.vue_vue_type_script_setup_true_lang-BmACvFIT.js";import{_ as ue}from"./PageHeader.vue_vue_type_script_setup_true_lang-B0uxv-vX.js";import{l as ce}from"./lodash-D4b64Inp.js";import"./index-CyzG3B7Q.js";import"./index-DskH3tKn.js";import"./useForwardPropsEmits-mgxhVe2d.js";import"./useForwardExpose-DvgX0o-v.js";import"./useFocusGuards-_TrNIUuM.js";import"./Teleport-sQDXNy6f.js";import"./VisuallyHidden-BEO5d0G6.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-43_aYyr-.js";import"./RovingFocusGroup-DvsoFtKQ.js";import"./createLucideIcon-BM0PkPLY.js";import"./x-BMJwbN6X.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CmZdlobI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-BEKNO1yO.js";const ge={class:"py-12"},me={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},pe={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},ye={class:"p-6 lg:p-8 bg-white dark:bg-gray-800"},xe={class:"mb-8"},ve={class:"flex items-center justify-center"},fe={class:"flex items-center space-x-4"},be={class:"flex items-center"},he={class:"flex items-center"},_e={class:"flex items-center"},we={key:0,class:"space-y-6"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ce=["value"],Se={key:0,class:"space-y-4"},Ae={class:"flex justify-between items-center"},je={key:0,class:"text-center py-4"},Ue={key:1,class:"text-center py-4 text-gray-500"},Te={key:2,class:"max-h-60 overflow-y-auto border border-gray-200 rounded-md"},$e=["onClick"],qe={class:"font-medium text-gray-900"},Ne={class:"text-sm text-gray-600"},Oe={class:"text-xs text-gray-500"},Ee={key:0,class:"text-green-600"},Fe={key:1,class:"space-y-4"},Ve={class:"flex justify-between items-center"},ze={class:"font-medium text-gray-900 dark:text-white"},Me={class:"max-h-40 overflow-y-auto border border-gray-200 rounded-md"},Be={class:"font-medium text-gray-900"},Re={class:"text-sm text-gray-600 ml-2"},Pe=["onClick"],De={key:0,class:"bg-gray-50 p-4 rounded-md"},He={class:"grid grid-cols-3 gap-4 text-sm"},Ie={class:"font-medium ml-1"},Ke={class:"font-medium ml-1"},Le={class:"font-medium ml-1"},Xe={class:"flex justify-end"},Je=["disabled"],Qe={key:1,class:"space-y-6"},Ge={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},We=["onClick"],Ye={class:"space-y-2"},Ze={class:"flex justify-between items-start"},et={class:"font-medium text-gray-900"},tt={key:0,class:"text-indigo-600"},st={class:"text-sm text-gray-600"},ot={class:"font-mono"},rt={class:"text-sm text-gray-600"},nt={class:"capitalize"},it={class:"text-sm text-gray-600"},at={class:"flex justify-between"},lt=["disabled"],dt={key:2,class:"space-y-6"},ut={class:"bg-gray-50 p-6 rounded-lg space-y-4"},ct={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},gt={key:0,class:"space-y-1"},mt={class:"font-medium"},pt={class:"text-sm text-gray-600"},yt={class:"text-sm text-gray-600"},xt={class:"text-sm text-gray-600"},vt={class:"font-medium"},ft={class:"space-y-4"},bt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ht={key:0,class:"text-red-600 text-sm mt-1"},_t={key:0,class:"bg-red-50 border border-red-200 rounded-md p-4"},wt={class:"list-disc list-inside text-red-700 text-sm space-y-1"},kt={class:"flex justify-between"},Ct=["disabled"],St={key:0},At={key:1},jt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ut={class:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto"},Tt={class:"flex justify-between items-start mb-4"},$t={class:"overflow-x-auto"},qt={class:"min-w-full divide-y divide-gray-200"},Nt={class:"bg-white divide-y divide-gray-200"},Ot={class:"px-6 py-4 whitespace-nowrap"},Et={class:"text-sm font-medium text-gray-900"},Ft={class:"text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},zt={class:"px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-600"},Mt={class:"px-6 py-4 whitespace-nowrap"},Bt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rt={class:"text-xs"},ns=oe({__name:"MassAssignment",props:{coupons:{},organizers:{},preSelectedCouponId:{},preSelectedCoupon:{}},setup(J){const p=J,y=g(1),b=g(""),j=g(""),x=g([]),d=g([]),m=g(p.preSelectedCoupon||null),v=g(null),q=g(!1),M=g(!1),N=g(!1),B=g([]),r=re({coupon_id:p.preSelectedCouponId||null,user_ids:[],quantity:1,expires_at:"",notes:"",processing:!1,errors:{}}),R=_(()=>d.value.map(o=>o.id)),Q=_(()=>p.preSelectedCoupon?`Mass Assign: ${p.preSelectedCoupon.name}`:"Mass Coupon Assignment"),G=_(()=>p.preSelectedCoupon?`Assign "${p.preSelectedCoupon.code}" to multiple users at once`:"Assign coupons to multiple users at once"),O=_(()=>d.value.length>0),E=_(()=>m.value!==null),F=_(()=>r.coupon_id&&r.user_ids.length>0&&r.quantity>0),P=_(()=>d.value.length*r.quantity),D=ce.debounce(async()=>{var o;if(b.value.length<2){x.value=[];return}q.value=!0;try{const s=await(await fetch(route("admin.coupon-assignment.search-users"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({search:b.value,organizer_id:j.value||null,limit:50})})).json();x.value=s.users||[]}catch(t){console.error("Search failed:",t),x.value=[]}finally{q.value=!1}},300),H=o=>{d.value.find(t=>t.id===o.id)||(d.value.push(o),I())},W=o=>{d.value=d.value.filter(t=>t.id!==o),I()},Y=()=>{x.value.forEach(o=>H(o))},Z=()=>{d.value=[],v.value=null},I=async()=>{var o;if(d.value.length===0){v.value=null;return}M.value=!0;try{const s=await(await fetch(route("admin.coupon-assignment.user-stats"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""},body:JSON.stringify({user_ids:R.value})})).json();v.value=s}catch(t){console.error("Failed to load user stats:",t)}finally{M.value=!1}},ee=o=>{m.value=o,r.coupon_id=o.id},U=o=>{o===2&&!O.value||o===3&&!E.value||(y.value=o,o===3&&(r.user_ids=R.value))},te=async()=>{var o,t,s,c,S;if(F.value){r.processing=!0;try{const h=await le.post(route("admin.coupon-assignment.assign"),{coupon_id:r.coupon_id,user_ids:r.user_ids,quantity:r.quantity,expires_at:r.expires_at,notes:r.notes},{headers:{"X-CSRF-TOKEN":((o=document.querySelector('meta[name="csrf-token"]'))==null?void 0:o.getAttribute("content"))||""}});h.data.success?(y.value=1,d.value=[],m.value=p.preSelectedCoupon||null,r.reset(),r.coupon_id=p.preSelectedCouponId||null,r.errors={},v.value=null,alert(`Success: ${h.data.message}`),console.log("Assignment successful:",h.data)):alert(`Error: ${h.data.message}`)}catch(h){const w=h;console.error("Assignment failed:",w),(s=(t=w.response)==null?void 0:t.data)!=null&&s.errors?Object.keys(w.response.data.errors).forEach(L=>{r.errors[L]=w.response.data.errors[L][0]}):(S=(c=w.response)==null?void 0:c.data)!=null&&S.message?alert(`Error: ${w.response.data.message}`):alert("An unexpected error occurred during assignment.")}finally{r.processing=!1}}},se=async()=>{try{const t=await(await fetch(route("admin.coupon-assignment.history"),{method:"GET",headers:{"Content-Type":"application/json"}})).json();B.value=t.assignments||[],N.value=!0}catch(o){console.error("Failed to load history:",o)}},K=(o,t)=>t==="percentage"?`${o}%`:`$${(o/100).toFixed(2)}`;return X(b,D),X(j,D),(o,t)=>(i(),n("div",null,[T(l(ne),{title:"Mass Coupon Assignment"}),T(de,null,{default:V(()=>[e("div",ge,[e("div",me,[e("div",pe,[e("div",ye,[T(ue,{title:Q.value,subtitle:G.value},{actions:V(()=>[e("button",{onClick:se,class:"inline-flex items-center px-4 py-2 bg-gray-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-gray-500 focus:outline-none focus:border-gray-700 focus:ring focus:ring-gray-200 disabled:opacity-25 transition mr-3"}," View History "),T(l(ie),{href:o.route("admin.coupons.index"),class:"inline-flex items-center px-4 py-2 bg-indigo-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-indigo-500 focus:outline-none focus:border-indigo-700 focus:ring focus:ring-indigo-200 disabled:opacity-25 transition"},{default:V(()=>t[10]||(t[10]=[z(" Back to Coupons ")])),_:1},8,["href"])]),_:1},8,["title","subtitle"]),e("div",xe,[e("div",ve,[e("div",fe,[e("div",be,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",y.value>=1?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 1 ",2),t[11]||(t[11]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Select Users",-1))]),t[14]||(t[14]=e("div",{class:"w-12 h-1 bg-gray-300 rounded"},null,-1)),e("div",he,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",y.value>=2?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 2 ",2),t[12]||(t[12]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Choose Coupon",-1))]),t[15]||(t[15]=e("div",{class:"w-12 h-1 bg-gray-300 rounded"},null,-1)),e("div",_e,[e("div",{class:f(["w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium",y.value>=3?"bg-indigo-600 text-white":"bg-gray-300 text-gray-700"])}," 3 ",2),t[13]||(t[13]=e("span",{class:"ml-2 text-sm font-medium text-gray-900 dark:text-white"},"Confirm & Assign",-1))])])])]),y.value===1?(i(),n("div",we,[t[25]||(t[25]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 1: Select Users",-1)),e("div",ke,[e("div",null,[t[16]||(t[16]=e("label",{for:"search",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Search Users",-1)),A(e("input",{id:"search","onUpdate:modelValue":t[0]||(t[0]=s=>b.value=s),type:"text",placeholder:"Search by name or email...",class:"mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[$,b.value]])]),e("div",null,[t[18]||(t[18]=e("label",{for:"organizer",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Filter by Organizer",-1)),A(e("select",{id:"organizer","onUpdate:modelValue":t[1]||(t[1]=s=>j.value=s),class:"mt-1 block w-full border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},[t[17]||(t[17]=e("option",{value:""},"All Organizers",-1)),(i(!0),n(k,null,C(o.organizers,s=>(i(),n("option",{key:s.id,value:s.id},a(s.name),9,Ce))),128))],512),[[ae,j.value]])])]),b.value.length>=2?(i(),n("div",Se,[e("div",Ae,[t[19]||(t[19]=e("h4",{class:"font-medium text-gray-900 dark:text-white"},"Search Results",-1)),x.value.length>0?(i(),n("button",{key:0,onClick:Y,class:"text-sm text-indigo-600 hover:text-indigo-800"}," Select All ("+a(x.value.length)+") ",1)):u("",!0)]),q.value?(i(),n("div",je,t[20]||(t[20]=[e("div",{class:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600"},null,-1),e("span",{class:"ml-2 text-sm text-gray-600"},"Searching...",-1)]))):x.value.length===0&&b.value.length>=2?(i(),n("div",Ue," No users found matching your search. ")):(i(),n("div",Te,[(i(!0),n(k,null,C(x.value,s=>(i(),n("div",{key:s.id,class:"p-3 border-b border-gray-200 hover:bg-gray-50 cursor-pointer flex justify-between items-center",onClick:c=>H(s)},[e("div",null,[e("div",qe,a(s.name),1),e("div",Ne,a(s.email),1),e("div",Oe,"Member since "+a(s.member_since),1)]),d.value.find(c=>c.id===s.id)?(i(),n("div",Ee," ✓ Selected ")):u("",!0)],8,$e))),128))]))])):u("",!0),d.value.length>0?(i(),n("div",Fe,[e("div",Ve,[e("h4",ze,"Selected Users ("+a(d.value.length)+")",1),e("button",{onClick:Z,class:"text-sm text-red-600 hover:text-red-800"}," Clear All ")]),e("div",Me,[(i(!0),n(k,null,C(d.value,s=>(i(),n("div",{key:s.id,class:"p-2 border-b border-gray-200 flex justify-between items-center"},[e("div",null,[e("span",Be,a(s.name),1),e("span",Re,a(s.email),1)]),e("button",{onClick:c=>W(s.id),class:"text-red-600 hover:text-red-800 text-sm"}," Remove ",8,Pe)]))),128))]),v.value?(i(),n("div",De,[t[24]||(t[24]=e("h5",{class:"font-medium text-gray-900 mb-2"},"Selected User Statistics",-1)),e("div",He,[e("div",null,[t[21]||(t[21]=e("span",{class:"text-gray-600"},"Total Users:",-1)),e("span",Ie,a(v.value.total_users),1)]),e("div",null,[t[22]||(t[22]=e("span",{class:"text-gray-600"},"Active Users:",-1)),e("span",Ke,a(v.value.active_users),1)]),e("div",null,[t[23]||(t[23]=e("span",{class:"text-gray-600"},"With Coupons:",-1)),e("span",Le,a(v.value.users_with_coupons),1)])])])):u("",!0)])):u("",!0),e("div",Xe,[e("button",{onClick:t[2]||(t[2]=s=>U(2)),disabled:!O.value,class:f(["px-4 py-2 rounded-md font-semibold text-sm",O.value?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Next: Choose Coupon ",10,Je)])])):u("",!0),y.value===2?(i(),n("div",Qe,[t[28]||(t[28]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 2: Choose Coupon",-1)),e("div",Ge,[(i(!0),n(k,null,C(o.coupons,s=>{var c,S;return i(),n("div",{key:s.id,class:f(["border-2 rounded-lg p-4 cursor-pointer transition-colors",((c=m.value)==null?void 0:c.id)===s.id?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"]),onClick:h=>ee(s)},[e("div",Ye,[e("div",Ze,[e("h4",et,a(s.name),1),((S=m.value)==null?void 0:S.id)===s.id?(i(),n("div",tt," ✓ ")):u("",!0)]),e("div",st,[t[26]||(t[26]=z(" Code: ")),e("span",ot,a(s.code),1)]),e("div",rt,[t[27]||(t[27]=z(" Type: ")),e("span",nt,a(s.type.replace("_"," ")),1)]),e("div",it," Discount: "+a(K(s.discount_value,s.discount_type)),1)])],10,We)}),128))]),e("div",at,[e("button",{onClick:t[3]||(t[3]=s=>U(1)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Back: Select Users "),e("button",{onClick:t[4]||(t[4]=s=>U(3)),disabled:!E.value,class:f(["px-4 py-2 rounded-md font-semibold text-sm",E.value?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])}," Next: Confirm Assignment ",10,lt)])])):u("",!0),y.value===3?(i(),n("div",dt,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"Step 3: Confirm & Assign",-1)),e("div",ut,[t[31]||(t[31]=e("h4",{class:"font-medium text-gray-900"},"Assignment Summary",-1)),e("div",ct,[e("div",null,[t[29]||(t[29]=e("h5",{class:"text-sm font-medium text-gray-700 mb-2"},"Selected Coupon",-1)),m.value?(i(),n("div",gt,[e("div",mt,a(m.value.name),1),e("div",pt,"Code: "+a(m.value.code),1),e("div",yt," Discount: "+a(K(m.value.discount_value,m.value.discount_type)),1)])):u("",!0)]),e("div",null,[t[30]||(t[30]=e("h5",{class:"text-sm font-medium text-gray-700 mb-2"},"Recipients",-1)),e("div",xt,[e("div",null,a(d.value.length)+" users selected",1),e("div",null,a(l(r).quantity)+" coupon(s) per user",1),e("div",vt,"Total: "+a(P.value)+" coupons",1)])])])]),e("div",ft,[e("div",bt,[e("div",null,[t[32]||(t[32]=e("label",{for:"quantity",class:"block text-sm font-medium text-gray-700"},"Quantity per User",-1)),A(e("input",{id:"quantity","onUpdate:modelValue":t[5]||(t[5]=s=>l(r).quantity=s),type:"number",min:"1",max:"10",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[$,l(r).quantity,void 0,{number:!0}]]),l(r).errors.quantity?(i(),n("div",ht,a(l(r).errors.quantity),1)):u("",!0)]),e("div",null,[t[33]||(t[33]=e("label",{for:"expires_at",class:"block text-sm font-medium text-gray-700"},"Custom Expiry (Optional)",-1)),A(e("input",{id:"expires_at","onUpdate:modelValue":t[6]||(t[6]=s=>l(r).expires_at=s),type:"datetime-local",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[$,l(r).expires_at]])])]),e("div",null,[t[34]||(t[34]=e("label",{for:"notes",class:"block text-sm font-medium text-gray-700"},"Notes (Optional)",-1)),A(e("textarea",{id:"notes","onUpdate:modelValue":t[7]||(t[7]=s=>l(r).notes=s),rows:"3",placeholder:"Add any notes about this assignment...",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"},null,512),[[$,l(r).notes]])])]),Object.keys(l(r).errors).length>0?(i(),n("div",_t,[t[35]||(t[35]=e("h4",{class:"text-red-800 font-medium mb-2"},"Please fix the following errors:",-1)),e("ul",wt,[(i(!0),n(k,null,C(l(r).errors,(s,c)=>(i(),n("li",{key:c},a(s),1))),128))])])):u("",!0),e("div",kt,[e("button",{onClick:t[8]||(t[8]=s=>U(2)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Back: Choose Coupon "),e("button",{onClick:te,disabled:!F.value||l(r).processing,class:f(["px-6 py-2 rounded-md font-semibold text-sm",F.value&&!l(r).processing?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"])},[l(r).processing?(i(),n("span",St,"Assigning...")):(i(),n("span",At,"Assign "+a(P.value)+" Coupons",1))],10,Ct)])])):u("",!0)])])])]),N.value?(i(),n("div",jt,[e("div",Ut,[e("div",Tt,[t[38]||(t[38]=e("h3",{class:"text-lg font-semibold"},"Assignment History",-1)),e("button",{onClick:t[9]||(t[9]=s=>N.value=!1),class:"text-gray-400 hover:text-gray-600"},t[37]||(t[37]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",$t,[e("table",qt,[t[39]||(t[39]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"User"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Coupon"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Code"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Assigned")])],-1)),e("tbody",Nt,[(i(!0),n(k,null,C(B.value,s=>(i(),n("tr",{key:s.id},[e("td",Ot,[e("div",Et,a(s.user_name),1),e("div",Ft,a(s.user_email),1)]),e("td",Vt,a(s.coupon_name),1),e("td",zt,a(s.unique_code),1),e("td",Mt,[e("span",{class:f(["px-2 inline-flex text-xs leading-5 font-semibold rounded-full",s.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},a(s.status),3)]),e("td",Bt,[e("div",null,a(s.assigned_at),1),e("div",Rt,"by "+a(s.assigned_by),1)])]))),128))])])])])])):u("",!0)]),_:1})]))}});export{ns as default};
