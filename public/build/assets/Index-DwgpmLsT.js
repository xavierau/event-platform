import{d as S,a as n,i as v,o as r,z as I,f as s,g as b,t as u,j as M,n as H,s as a,C as Y,A as z,x as L,b as _,e as N,m as O,w as Q,h as K,F as X}from"./app-BlriFIqe.js";import{_ as G}from"./AppLayout.vue_vue_type_script_setup_true_lang-BPRGBHPc.js";import{d as J}from"./dayjs.min-BUQYLSfz.js";import{U as W}from"./vue-qrcode-reader-DATe4XAn.js";import"./index-n8QSRl2p.js";import"./index-Bhpe8JcZ.js";import"./useForwardPropsEmits-BFEAxE1x.js";import"./useForwardExpose-CTSY01TP.js";import"./useFocusGuards-DE3wpZyr.js";import"./Teleport-XyWxSjNg.js";import"./VisuallyHidden-c1buR7Qf.js";import"./UserMenuContent.vue_vue_type_script_setup_true_lang-BKdqBXVk.js";import"./RovingFocusGroup-C8rdEAgk.js";import"./createLucideIcon-C1ebVwtv.js";import"./x-DhC37dsd.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BGa5dCta.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useToast-D6MTp1Xk.js";const Z={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center"},ee=S({__name:"CouponLoadingModal",props:{show:{type:Boolean}},setup($){return(x,c)=>x.show?(r(),n("div",Z,c[0]||(c[0]=[I('<div class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl max-w-md w-full mx-4"><div class="text-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div><h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">Processing QR Code...</h3><p class="text-sm text-gray-500 dark:text-gray-400">Validating coupon and checking status</p></div></div>',1)]))):v("",!0)}}),se={key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},te={class:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white dark:bg-gray-800"},oe={class:"mt-3"},ae={class:"flex items-center justify-between mb-4"},re={class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4"},ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"space-y-1 text-sm"},de={class:"space-y-1 text-sm"},ue={key:0,class:"bg-yellow-50 dark:bg-yellow-900 rounded-lg p-4 mb-4"},ie={class:"flex justify-end space-x-3 p-5 border-t border-gray-200 dark:border-gray-700"},ce=["disabled"],me={key:0},pe={key:1},ge={key:2},ve={key:3},ye=S({__name:"CouponDetailsModal",props:{show:{type:Boolean},couponDetails:{},couponHistory:{},redeemStatus:{},isProcessing:{type:Boolean}},emits:["close","redeem"],setup($,{emit:x}){const c=x,k=t=>t.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()),d=(t,e)=>e==="fixed"?`$${(t/100).toFixed(2)}`:`${t}%`,m=t=>t?J(t).format("MMM D, YYYY"):"N/A",h=t=>{const e="px-2 inline-flex text-xs leading-5 font-semibold rounded-full";switch(t){case"ACTIVE":return`${e} bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100`;case"FULLY_USED":return`${e} bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100`;case"EXPIRED":return`${e} bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100`;default:return`${e} bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-100`}};return(t,e)=>{var y,p;return t.show&&t.couponDetails?(r(),n("div",se,[s("div",te,[s("div",oe,[s("div",ae,[e[4]||(e[4]=s("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100"},"Coupon Details",-1)),s("button",{onClick:e[0]||(e[0]=i=>c("close")),class:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"},e[3]||(e[3]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s("div",re,[s("div",ne,[s("div",null,[e[9]||(e[9]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"Coupon Information",-1)),s("div",le,[s("div",null,[e[5]||(e[5]=s("span",{class:"font-medium"},"Name:",-1)),b(" "+u(t.couponDetails.details.coupon.name),1)]),s("div",null,[e[6]||(e[6]=s("span",{class:"font-medium"},"Code:",-1)),b(" "+u(t.couponDetails.user_coupon.unique_code),1)]),s("div",null,[e[7]||(e[7]=s("span",{class:"font-medium"},"Type:",-1)),b(" "+u(k(t.couponDetails.details.coupon.type)),1)]),s("div",null,[e[8]||(e[8]=s("span",{class:"font-medium"},"Discount:",-1)),b(" "+u(d(t.couponDetails.details.coupon.discount_value,t.couponDetails.details.coupon.discount_type)),1)])])]),s("div",null,[e[13]||(e[13]=s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-2"},"Validity & Status",-1)),s("div",de,[s("div",null,[e[10]||(e[10]=s("span",{class:"font-medium"},"Status:",-1)),s("span",{class:M(h(t.couponDetails.user_coupon.status))},u(t.couponDetails.user_coupon.status),3)]),s("div",null,[e[11]||(e[11]=s("span",{class:"font-medium"},"Valid From:",-1)),b(" "+u(m(t.couponDetails.details.coupon.valid_from)),1)]),s("div",null,[e[12]||(e[12]=s("span",{class:"font-medium"},"Expires At:",-1)),b(" "+u(m(t.couponDetails.details.coupon.expires_at)),1)])])])])]),t.couponHistory?(r(),n("div",ue,e[14]||(e[14]=[s("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-3"},"Usage History",-1)]))):v("",!0),t.redeemStatus?(r(),n("div",{key:1,class:M(["mt-4 p-3 rounded-md text-sm",{"bg-green-50 dark:bg-green-700 border border-green-300 dark:border-green-600 text-green-700 dark:text-green-200":t.redeemStatus.success,"bg-red-50 dark:bg-red-700 border border-red-300 dark:border-red-600 text-red-700 dark:text-red-200":!t.redeemStatus.success}])},u(t.redeemStatus.message),3)):v("",!0)]),s("div",ie,[s("button",{onClick:e[1]||(e[1]=i=>c("close")),class:"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300"},"Cancel"),s("button",{onClick:e[2]||(e[2]=i=>c("redeem")),disabled:t.isProcessing||t.couponDetails.user_coupon.status!=="ACTIVE"||((y=t.redeemStatus)==null?void 0:y.success)===!0,class:"px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 disabled:bg-indigo-300"},[t.isProcessing&&!t.redeemStatus?(r(),n("span",me,"Redeeming...")):((p=t.redeemStatus)==null?void 0:p.success)===!0?(r(),n("span",pe,"Redeemed")):t.couponDetails.user_coupon.status!=="ACTIVE"?(r(),n("span",ge,"Cannot Redeem")):(r(),n("span",ve,"Confirm Redemption"))],8,ce)])])])):v("",!0)}}}),fe={class:"py-12"},be={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},we={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},xe={class:"p-6 lg:p-8"},ke={key:0,class:"mt-4 p-4 bg-red-100 text-red-700 rounded-md"},he={key:1,class:"mt-4 p-4 bg-red-100 text-red-700 rounded-md"},_e={key:2},Ce={class:"mt-6"},Se={class:"relative w-full max-w-md mx-auto border-4 border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden"},$e={key:0,class:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"},De={key:0,class:"mt-4 p-4 text-center bg-red-100 text-red-700 rounded-md"},Ee={key:1,class:"mt-4 p-4 text-center bg-red-100 text-red-700 rounded-md"},Qe=S({__name:"Index",setup($){var T;const c=H().props,k=a(!1),d=a(null),m=a(null),h=a(null),t=a(null),e=a(!1),y=a(!1),p=a(!1),i=a(null),V=a(0),D=a(null),C=a(!1),j=a(!1),E=a(!1),P=a(!1),q=a(""),f=Y({unique_code:"",location:"Scanner",details:{},operator_user_id:(T=c.auth.user)==null?void 0:T.id}),A=async l=>{if(e.value||l.length===0)return;const o=l[0].rawValue;D.value=o,p.value=!0,e.value=!0,d.value=null,m.value=null,i.value=null;try{const g=await fetch(route("api.v1.coupon-scanner.show",{uniqueCode:o})),w=await g.json();g.ok&&w.success?(m.value=w.data,d.value={success:`Coupon ${w.data.user_coupon.unique_code} found.`},f.unique_code=w.data.user_coupon.unique_code,y.value=!0):d.value={error:w.message||"Failed to validate coupon."}}catch(g){d.value={error:g.message||"Error processing QR code."}}finally{p.value=!1,e.value=!1}},U=async()=>{var l;if(f.unique_code){e.value=!0,i.value=null;try{const o=await fetch(route("api.v1.coupon-scanner.redeem",{uniqueCode:f.unique_code}),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":(l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.content,Accept:"application/json"},body:JSON.stringify(f.data())}),g=await o.json();i.value={success:o.ok&&g.success,message:g.message}}catch(o){i.value={success:!1,message:o.message||"An unexpected error occurred."}}finally{e.value=!1}}},F=l=>{let o=`Camera error: ${l.name}`;switch(l.name){case"NotAllowedError":o="Camera access denied. Please allow camera access in your browser settings and refresh the page.";break;case"NotFoundError":o="No camera found. Please ensure a camera is connected to your device.";break;case"NotReadableError":o="Camera is already in use by another application. Please close other apps using the camera.";break;case"OverconstrainedError":o="Camera constraints could not be satisfied. Try refreshing the page.";break;case"SecurityError":o="Camera access blocked due to security restrictions. Ensure you are on HTTPS.";break;case"AbortError":o="Camera access was aborted. Please try again.";break;default:o=`Camera error: ${l.name}. ${l.message||"Please ensure camera access is allowed."}`}t.value=o},B=()=>{k.value=!0,t.value=null},R=async()=>{d.value=null,m.value=null,h.value=null,i.value=null,e.value=!1,y.value=!1,p.value=!1,D.value=null,t.value=null,C.value=!0,await new Promise(l=>setTimeout(l,100)),C.value=!1,f.reset(),f.unique_code=""};return z(()=>{j.value=window.location.protocol==="https:",E.value=window.isSecureContext,P.value=!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),q.value=window.location.href}),L(()=>{}),(l,o)=>(r(),n(X,null,[_(N(O),{title:"Coupon Scanner"}),_(G,null,{default:Q(()=>[s("div",fe,[s("div",be,[s("div",we,[s("div",xe,[o[2]||(o[2]=s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Coupon QR Code Scanner",-1)),E.value?P.value?(r(),n("div",_e,[s("div",Ce,[s("div",Se,[(r(),K(N(W),{key:V.value,onDetect:A,onCameraError:F,onReady:B,paused:C.value},null,8,["paused"])),k.value?v("",!0):(r(),n("div",$e,o[0]||(o[0]=[s("p",{class:"text-white text-lg"},"Initializing Camera...",-1)]))),o[1]||(o[1]=s("div",{class:"absolute inset-0 flex items-center justify-center"},[s("div",{class:"w-64 h-64 border-4 border-red-500 rounded-lg opacity-50"})],-1))]),t.value?(r(),n("div",De,u(t.value),1)):v("",!0),d.value&&d.value.error?(r(),n("div",Ee,u(d.value.error),1)):v("",!0),s("div",{class:"mt-4 text-center"},[s("button",{onClick:R,class:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-md"},"Reset Scanner")])])])):(r(),n("div",he," Your browser does not support the necessary camera APIs. Please try a different browser. ")):(r(),n("div",ke," Camera access requires a secure context (HTTPS). You are currently on an insecure connection. "))])])])]),_(ee,{show:p.value},null,8,["show"]),_(ye,{show:y.value,"coupon-details":m.value,"coupon-history":h.value,"redeem-status":i.value,"is-processing":e.value,onClose:R,onRedeem:U},null,8,["show","coupon-details","coupon-history","redeem-status","is-processing"])]),_:1})],64))}});export{Qe as default};
